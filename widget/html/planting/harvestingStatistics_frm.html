<!DOCTYPE html>
<html lang="en">
<head>
		<meta http-equiv="Content-type" content="text/html; charset=utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
		<title>采收统计</title>
		<link rel="stylesheet" type="text/css" href="../../css/common/api.css">
		<script type="text/javascript" src="../../script/common/rem.js"></script>
		<link rel="stylesheet" href="../../css/common/public.css" />
    <style>
				article{
					position: absolute;
					padding-top: 0.2rem;
					padding-left: 0.2rem;
					padding-right: 0.2rem;
					padding-bottom: 0.6rem;
					background-color: #f3f4f4;
					left: 0;
					right: 0;
					top: 0;
					bottom: 0;
					overflow-y: auto;
					-webkit-overflow-scrolling:touch;
					z-index: 1;
				}
				section{
					margin-top: 0.2rem;
					background-color: #ededed;
				}
				#section1{
					padding-top: 0.25rem;
					padding-bottom: 0.25rem;
					text-align: center;
					background-color: #f3f4f4;
				}
				#section2{
					margin-top: 0.3rem;
				}
				#section1 li{
					height: 0.8rem;
					line-height: 0.8rem;
					text-align: center;
				}
				#section1 li span{
					display: inline-block;
					font-size: 0.3rem;
					width: 1.7rem;
				  color: #204e41;
				}
				input{
					font-size: 0.3rem;
					padding-top: 0.1rem;
					padding-bottom: 0.1rem;
					width: 3.4rem;
					padding-left: 0.1rem;
					color: #204e41;
				}
				button{
					width: 5.7rem;
					height: 0.8rem;
					background-color: #c3a256;
					color:#ededed;
					font-size: 0.3rem;
					border-radius: 0.1rem;
					outline: 0;
				}
				.container1,.container2{
					width: 100%;
					height: 6rem;
					overflow: hidden;
				}
				#container1{
					/*margin-top: -20%;
					margin-left: -20%;
					width: 140%;
					height: 140%;*/
					width: 7.2rem;
					height: 6rem;
				}
				#container5{
					/*margin-top: -20%;
					margin-left: -20%;
					width: 140%;
					height: 140%;*/
					width: 7.2rem;
					height: 6rem;
				}
				#container2{
					width: 100%;
					height: 6rem;
				}
				.container3{
					position: relative;
					margin-left: 0.2rem;
					width: 100%;
					height: 6rem;
				}
				/*.containerLeft{
					position: absolute;
					width: 0.8rem;
					height: 100%;
					overflow: hidden;
				}
				.containerRight{
					position: absolute;
					left: 0.8rem;
					width: 81%;
					height: 100%;
					overflow-x: scroll;
					overflow-y: hidden;
				}
				#container3{
					width: 20rem;
					height: 100%;
				}
				#container4{
					width: 20.8rem;
					height: 100%;
				}*/
				#part2{
					display: none;
				}
				.biaoTitle{
					padding: 0.2rem;
				}
				.titleContent{
					font-size: 0.36rem;
					text-align: center;
					height: 0.8rem;
					line-height: 0.8rem;
					color: #204e41;
					border-bottom: 1px solid #f6f3f3
				}
				.xuanxiang{
					position: relative;
					/*border-bottom: 1px solid #f6f3f3;*/
					height: 1rem;
					background-color: #f3f4f4;
					z-index: 9999;
				}
				.plantA{
					float: left;
					text-align: center;
					height: 1rem;
					line-height: 1rem;
					width: 50%;
					font-size: 0.3rem;
					color: #204e41;
					background-color: #ededed;
				}
				.plantB{
					float: left;
					height: 1rem;
					line-height: 1rem;
					text-align: center;
					width: 50%;
					font-size: 0.3rem;
					color: #a0b2a6;
					background-color: #f3f4f4;
				}
				#partA1{
					width: 1.6rem;
					height: 1px;
					margin-left: 0.95rem;
					background-color: #00c558;
				}
				#partA2{
					display: none;
					width: 1.8rem;
					height: 1px;
					margin-left: 0.85rem;
					background-color: #00c558;
				}
				.nianyue{
					text-align: center;
					height: 1rem;
					line-height: 1rem;
					font-size: 0.26rem;
					color: #374c4f;
					border-top: 1px solid #f6f3f3;
					border-bottom: 1px solid #f6f3f3;
				}
				.xuan{
					padding-bottom: 0.42rem;
					padding-left: 0.3rem;
				}
				.dikuai{
					display: inline-block;
					margin-right: -0.3rem;
					height: 0.3rem;
					line-height: 0.3rem;
					font-size: 0.28rem;
					text-align: right;
					color: #204e41;
				}
				.shuru{
					display: inline-block;
					position: relative;
				}
				.shuru1{
					display: inline-block;
					position: relative;
					padding-left: 0.2rem;
					width: 2.74rem;
					font-size: 0.28rem;
					color: #204e41;
				}
				.shuru2{
					display: inline-block;
					position: relative;
					padding-left: 0.2rem;
					width: 1.34rem;
					font-size: 0.28rem;
					color: #204e41;
				}
				select{
					display: inline-block;
					width: 1rem;
					height: 0.8rem;
					background-color: rgba(32,78,65,0.1);
	  			border: 1px solid #204e41 !important;
	  		}
				i{
					position: absolute;
					top: 0.8rem;
					right: 0.2rem;
					width: 0;
					height: 0;
					border-left: 0.2rem solid transparent;
					border-right: 0.2rem solid transparent;
					border-top: 0.2rem solid #204e41;
				}
				.shuju{
					margin-top: 0.7rem;
					height: 2.25rem;
					background-color: #ededed;
				}
				.jihuashuju{
					display: inline-block;
					text-align: center;
					width: 48%;
					font-size: 0.6rem;
					color: #43c5f1;

				}
				.shijishuju{
					display: inline-block;
					text-align: center;
					width: 48%;
					font-size: 0.6rem;
					color: #374c4f;
					border-left: 1px solid #f6f3f3;
				}
				.shujuyuan{
					font-size: 0.34rem;
					color: #747976;
				}
				#body_totop_btn{
						position: fixed;
						bottom:0.5rem;
						right:0.2rem;
						width:1.2rem;
						height:1.2rem;
						z-index: 999;
						line-height: 2.25rem;
						font-size: 0.2rem;font-family: PingFangSC-Regular, sans-serif;color: #AEADAD;
						text-align: center;
						background: url("../../image/planting/top.png") no-repeat center 3px;
						background-size: 70% 70%;
						background-color: rgba(0,0,0,0);
						border-radius: 6px;
						font-size: 0.20rem;
						color: #204e41;
						display: none;
				}
				.you{
					position: fixed;
					top: 0;
					right: 0;
					left: 0;
					width: 100%;
					background-color: #ededed;
					z-index: 9999;
				}
				#noPic1{
					display: none;
					width: 100%;
					height: 6.36rem;
				}
				#noPic2{
					display: none;
					width: 100%;
					height: 6.43rem;
				}
				#noPic3{
					display: none;
					width: 100%;
					height: 7.1rem;
				}
				#shadowBar{
					position: absolute;
					pointer-events: none;
					left: 3.3rem;
					height: 6rem;
					width: 0.826rem;
					background-color: rgba(256,256,256,0.4);
					z-index: 9000;
				}
				#gong1{
					position: absolute;
					top: 0.31rem;
					left: 0.69rem;
					width: 0.3rem;
					height: 0.3rem;
				}
				#gong2{
					position: absolute;
					top: 0.31rem;
					left: 4.1rem;
					width: 0.3rem;
					height: 0.3rem;
				}
    </style>
</head>
<body>
<article id="wrapper">
    <section id="section1">
				<ul>
					<li>
						<span>哪个基地：</span>
						<input id="land"type="text" value="" readonly>
						<input id="landId" type="hidden">
					</li>
					<li>
						<span>统计时间：</span>
						<input id="time" type="text" value="" readonly>
						<input id="startDate" type="hidden">
						<input id="endDate" type="hidden">
					</li>
					<li>
						<span>种的作物：</span>
						<input id="crop" type="text" value="" readonly>
						<input id="catId" type="hidden">
					</li>
				</ul>
				<button id="select">点我选择</button>
    </section>
		<section>
			<div id="zhan"></div>
			<div id="xuanxiang" class="xuanxiang">
				<div id="partA" class="plantA">
					<img id="gong1"  src="../../image/planting/liang2.png" alt="">
					采收量情况
				</div>
				<div id="partB" class="plantB">
					<img id="gong2"  src="../../image/planting/pin1.png" alt="">
					采收品类分布
				</div>
			</div>
			<div class="xuan">
				<span class="dikuai">地块：</span>
				<span class="shuru">
						<select id="shuru1" class="shuru1" onchange="jidiChange()">
						</select>
						<i></i>
				</span>
				<span class="dikuai">采收单位：</span>
				<span class="shuru">
						<select id="shuru2" class="shuru2" onchange="jidiChange()">
						</select>
						<i></i>
				</span>
			</div>
			<div id="part2">
			<div class="biaoTitle">
				<div class="titleContent">当日品类分布</div>
			</div>
			<div class="container1">
				<img id="noPic1" src="../../image/planting/caishou.png" alt="">
				<div id="container1"></div>
			</div>
			<div class="biaoTitle">
				<div class="titleContent">累积品类分布</div>
			</div>
			<div class="container2">
				<img id="noPic2" src="../../image/planting/pinlei.png" alt="">
				<div id="container2"></div>
				</div>
			</div>
			<div id="part1">
				<div class="biaoTitle">
					<div id="today" class="titleContent"></div>
				</div>
				<div class="container1">
					<div id="shadowBar"></div>
					<img id="noPic3" src="../../image/planting/line.png" alt="">
					<div id="container5"></div>
				</div>
				<p id="nianyue" class="nianyue"></p>
				<div class="shuju">
					<div class="jihuashuju">
						<span id="dangricaishou" style="color:#47a48a"></span>
						<span id="shujuyuan" class="shujuyuan" style="color:#47a48a">当日采收总量</span>
					</div>
					<div class="shijishuju">
						<span id="todayTotal" style="color:#204e41"></span>
						<span class="shujuyuan" style="color:#204e41">累计采收总量</span>
					</div>
				</div>
			</div>
		</section>
</article>
<div id="body_totop_btn">
    返回顶部
</div>
<script type="text/javascript" src="../../script/common/api.js"></script>
<script type="text/javascript" src="../../script/common/jquery.min.js"></script>
<script type="text/javascript" src="../../script/common/pds.ajax.js"></script>
<script type="text/javascript" src="../../script/planting/echarts.min.js"></script>
<!-- <script type="text/javascript" src="../../script/planting/highcharts.js"></script> -->

<script type="text/javascript" src="../../script/planting/fusioncharts.js"></script>
<script type="text/javascript" src="../../script/planting/fusioncharts.theme.fint.js"></script>
<script type="text/javascript" src="../../script/planting/fusioncharts.widgets.js"></script>

<!-- <script src="https://www.fusioncharts.com/lib/fcassets/3.12.2/fusioncharts.js"></script> -->


<script>
	var myChart1,myChart2,myChart3
	apiready=function(){
		myChart1=echarts.init(document.getElementById('container1'))
		myChart2=echarts.init(document.getElementById('container5'))
		// var header = $api.byId('header');
		// 	$api.fixStatusBar(header);
		// 	var headerH = $api.offset(header).h;
		// 	$("body").css({"paddingTop":headerH+"px"});
			var show=1
			$("#partA").on("touchstart",function(){
				if(!show){
					show=1
					$("#partA").attr("class","plantA")
					$("#partB").attr("class","plantB")
					$("#part1").show()
					$("#part2").hide()
					$("#gong1").attr("src","../../image/planting/liang2.png")
					$("#gong2").attr("src","../../image/planting/pin1.png")
				}
			})
			$("#partB").on("touchstart",function(){
				if(show){
					show=null
					$("#partA").attr("class","plantB")
					$("#partB").attr("class","plantA")
					$("#part1").hide()
					$("#part2").show()
					$("#gong1").attr("src","../../image/planting/liang1.png")
					$("#gong2").attr("src","../../image/planting/pin2.png")
				}
			})
			$("#select").on("touchstart",function(){
					api.openWin({
						name : 'selectSearchTerm_win',
						url : './selectSearchTerm_win.html',
						pageParam: {
								pageId: 2
						}
					});
			})
			$("#shuru2").on("touchstart",function(){
				if(!$("#shuru2").val()){
					return
				}
			})
			initIn()
			scrollToTop()
	}

	function initIn(){
		if($api.getStorage('harvestingStatistics'+$api.getStorage("userId"))){
			//alert("接到缓存数据")
			var data=JSON.parse($api.getStorage('harvestingStatistics'+$api.getStorage("userId")))
			var startDate=data.startDates
			var endDate=data.endDates
			var farmId=data.farmIds
			var categoryId=data.categoryIds
			$("#time").val(startDate.replace(/\-/g, '.')+"-"+endDate.replace(/\-/g, '.'))
			$("#land").val(data.landNames)
			$("#crop").val(data.categorys)
			$("#landId").val(farmId)
			$("#catId").val(categoryId)
			$("#startDate").val(startDate)
			$("#endDate").val(endDate)
			$("#shuru1").val(farmId)
			// setTimeout(function(){
				//alert($("#landId").val())
				jidi(startDate,endDate,categoryId,farmId)
			// },300)
		}else{
			var d = new Date(), y = d.getFullYear(), m = d.getMonth() + 1, r = d.getDate();
			m < 10 ? m = "0" + m : m;
			r < 10 ? r = "0" + r : r;
			var endDate=y + "-" + m + "-" + r;
			var startDate=y + "-0" + 1 + "-0" + 1;
			$("#time").val(y+".01.01"+"-"+y + "." + m + "." + r)
			pds.ajaxSubmit({
				url:'app/commons/stat/firstEnterQueryParam',
				type : "GET",
				success:function(ret,err){
					//alert(JSON.stringify(ret))
					if(!ret.data.farm){
						alert("该账号下没有基地，请完善基地信息")
						return
					}
					if(!ret.data.category){
						alert("该账号下没有作物，请完善作物信息")
						return
					}

					$("#land").val(ret.data.farm.farmName)
					$("#crop").val(ret.data.category.catName)
					$("#landId").val(ret.data.farm.id)
					$("#catId").val(ret.data.category.id)
					$("#startDate").val(startDate)
					$("#endDate").val(endDate)
					// setTimeout(function(){
						//alert($("#landId").val())
						jidi(startDate,endDate,ret.data.category.id,ret.data.farm.id)
					// },300)
				},
			 error:function(e){
					api.alert({msg:"服务器异常，请联系管理员!"});
			 }
		});
		}
	}
	function pieFen(startDate,endDate,farmId,categoryId,numerator,landId){
		//alert("单位参数"+startDate+","+endDate+","+farmId+","+categoryId+","+numerator+","+landId)
		//alert("app/harvestStat/queryGradeOfHarvest")
		myChart1.clear()
		pds.ajaxSubmit({
		 url:'app/harvestStat/queryGradeOfHarvest',
		 type : "GET",
		 data:{startDate:startDate,endDate:endDate,farmId:farmId,categoryId:categoryId,numerator:numerator,landId:landId},
		 success:function(ret,err){
			 //api.alert({msg:JSON.stringify(ret)});
			 if(!ret.data.length){
				 $("#noPic1").show()
				 $("#container1").hide()
				 return
			 }else{
				 $("#noPic1").hide()
				 $("#container1").show()
			 }
			 var gradeName=[],harvestTotal=[],color=['#D0B178','#BF7A78','#6BADA6','#4D7291']
			 var date=ret.data,l=date.length;
			 for(var i=0;i<l;i++){
				 gradeName.push(date[i].gradeName)
				 harvestTotal.push({"value":date[i].harvestTotal,"name":date[i].gradeName})
				 if(l>5){
				 	color.push("rgb("+parseInt(Math.random()*257)+","+parseInt(Math.random()*257)+","+parseInt(Math.random()*257)+")")
				 }
			 }
				option1 = {
					  backgroundColor: '#ededed',
				    tooltip : {
				        trigger: 'item',
				        formatter: "<span style='z-index:0'>{a} <br/>{b} : {c} "+$("#shuru2").find("option:selected").text()+"({d}%)</span>"
				    },
						//color:['#FFC65C','#EE6B67','#32D6C5','#4198E1'],
						color:color,
				    visualMap: {
				        show: false,
				        min: 80,
				        max: 600,
				        inRange: {
				            colorLightness: [0, 1]
				        }
				    },
						legend: {
		         orient: 'vertical',
		         x: 'left',
		         data:gradeName
		       },
				    series : [
				        {
				            name:'采收品类分布',
				            type:'pie',
				            radius : '80%',
				            center: ['60%', '50%'],
				            data:harvestTotal.sort(function (a, b) { return a.value - b.value; }),
				            roseType: 'radius',
				            label: {
				                normal: {
															position: 'inner',
															formatter: "{c}"+$("#shuru2").find("option:selected").text()
				                }
				            },
				            // labelLine: {
				            //     normal: {
				            //         smooth: 0.2,
				            //         length: 10,
				            //         length2: 20
				            //     }
				            // },
				            itemStyle: {
				                normal: {
				                    // color: '#c23531',
				                    shadowBlur: 150,
				                    shadowColor: 'rgba(0, 0, 0, 0.4)'
				                }
				            },

				            animationType: 'scale',
				            animationEasing: 'elasticOut',
				            animationDelay: function (idx) {
				                return Math.random() * 200;
				            }
				        }
				    ]
				};
				myChart1.setOption(option1)
			},
		 error:function(e){
				api.alert({msg:"服务器异常，请联系管理员!"});
		 }
	});
	}
	function priFen(startDate,endDate,farmId,categoryId,numerator,landId){
		pds.ajaxSubmit({
		 url:'app/harvestStat/queryGradeOfHarvest',
		 type : "GET",
		 data:{startDate:startDate,endDate:endDate,farmId:farmId,categoryId:categoryId,numerator:numerator,landId:landId},
		success:function(ret,err){
			 //api.alert({msg:JSON.stringify(ret)});
			 if(!ret.data.length){
					 $("#noPic2").show()
					 $("#container2").hide()
					 return
			 }else{
					 $("#noPic2").hide()
					 $("#container2").show()
			 }
			 var pri=[];
			 var date=ret.data,l=date.length;
			 var c=['0','1','2','3','4','5','6','7','8','9','A','B','C','D','E','F'];
      var color=['dcd17e','6ec9be','7faccb','cba163','c7648d'];
			//  var ci=0;
			 for(var i=0;i<l;i++){
					 pri.push({
							 "value": date[i].harvestTotal,
							 "name": date[i].gradeName,
							 "color":	color[i],
							 "cleanValue": date[i].harvestTotal
					 })
			 }
				FusionCharts.ready(function () {
						var myChart = new FusionCharts({
								type: "pyramid",
								renderAt: 'container2',
								width:'100%',
								height:'105%',
								dataFormat: 'json',
								dataSource: {
											"chart": {
													"bgcolor": "dddddd",
													"caption": "",
													"basefontcolor": "204e41",
													"decimals": "0",
													"showToolTip":"0",
													"numbersuffix": $("#shuru2").find("option:selected").text(),
													"pyramidyscale": "50",
													"chartbottommargin": "20",
													"showborder": "0"
											},
											"data":pri.sort(function (a, b) { return a.value - b.value; })

									}
						});

						// Render the chart.
						myChart.render();
				});
			},
		 error:function(e){
				api.alert({msg:"服务器异常，请联系管理员!"});
		 }
	});
	}
function caiLiang(startDate,endDate,farmId,categoryId,numerator,landId){
	//alert("采收参数"+startDate+","+endDate+","+farmId+","+categoryId+","+numerator+","+landId)
	myChart2.clear()
	pds.ajaxSubmit({
	 url:'app/harvestStat/queryAmountOfHarvest',
	 type : "GET",
	 data:{startDate:startDate,endDate:endDate,farmId:farmId,categoryId:categoryId,numerator:numerator,landId:landId},
	 success:function(ret,err){
		 //api.alert({msg:JSON.stringify(ret)});
		 if(!ret.data.length){
			 $("#noPic3").show()
			 $("#shadowBar").hide()
			 $("#container5").hide()
			 $("#dangricaishou").html(0+$("#shuru2").find("option:selected").text())
			 $("#shujuyuan").html("当日采收总量")
			 return
			}else{
			 $("#noPic3").hide()
			 $("#shadowBar").show()
			 $("#container5").show()
			}
		 var categories=[],harvestTotal=["","",""]
		 var date=ret.data,l=date.length
		 for(var i=0;i<l;i++){
			 categories.push(date[i].recordDate.substring(2,10))
			 harvestTotal.push(date[i].harvestTotal)
		 }
		 var D1=new Date(date[0].recordDate.replace(/-/g,"\/"))
		 var D2=new Date(date[l-1].recordDate.replace(/-/g,"\/"))
		 for(j=1;j<4;j++){
			 var d1=new Date(D1-24*60*60*1000*j)
			 var d2=new Date(+D2+1000*60*60*24*j)
			 categories.unshift(d1.getFullYear()+"-"+(d1.getMonth()+1)+"-"+d1.getDate())
			 categories.push(d2.getFullYear()+"-"+(d2.getMonth()+1)+"-"+d2.getDate())
			 harvestTotal.push("")
		 }
		 $("#dangricaishou").html(date[l-1].harvestTotal+$("#shuru2").find("option:selected").text())
		 //$("#shujuyuan").html(date[l-1].recordDate.substring(2,4)+"年"+date[l-1].recordDate.substring(5,7)+"月"+date[l-1].recordDate.substring(8,10)+"日"+"<br>"+"采收总量")
		 	$("#nianyue").html(startDate.substring(0,4)+"年"+startDate.substring(5,7)+"月"+startDate.substring(8,10)+"日-"+endDate.substring(0,4)+"年"+endDate.substring(5,7)+"月"+endDate.substring(8,10)+"日")
		 //api.alert({msg:JSON.stringify(categories)});
		 option = {
			  backgroundColor: '#74aa9b',
				grid:{
					x:40,
					y:20,
					x2:30,
					y2:60
				},
			  tooltip : {
						show:false,
					  trigger: 'axis',
						axisPointer:{
								show: false,
								lineStyle: {
										width : 0
								}
						},
						backgroundColor:"#266b57",
						formatter: function (e) {
                return e[0].value
            }
				},
				dataZoom: [
					 {
							 show: false,
							 realtime: true,
							 handleColor: '#fff',
							 zoomLock:true,
							 handleSize:0,
							 showDetail: false,
							 borderColor:"#fff",
							 backgroundColor: '#ccc',
							 startValue: categories[l-1],
							 endValue: categories[l+5]
					 },
					 {
							 type: 'inside',
							 realtime: true,
							 zoomLock:true,
							 startValue: categories[l-1],
							 endValue: categories[l+5]
					 }
			 ],
		    xAxis: {
						splitLine:{show: false},
		        type: 'category',
		        data: categories,
						axisLine:{
									 lineStyle:{
											 color:'#fff',
											 width:1
									 }
						},
						axisLabel: {
						   interval:0,
						   rotate:-40
						}
		    },
		    yAxis: {
						//show:false,
						splitLine:{show: false},
		        type: 'log',
						axisLine:{
									 lineStyle:{
											 color:'#fff',
											 width:1
									 }
						},
						axisLabel:{
                    formatter: function (value) {
											value=value+""
											if(value.length<=3){
												return value
											}
											if(value.length>3&&value.length<=6){
												return value.slice(0, -3)+"k"
											}
											if(value.length>6&&value.length<=9){
												return value.slice(0, -6)+"m"
											}
											if(value.length>9&&value.length<=12){
												return value.slice(0, -9)+"b"
											}
											if(value.length>12&&value.length<=15){
												return value.slice(0, -12)+"t"
											}
											if(value.length>15&&value.length<=18){
												return value.slice(0, -15)+"p"
											}
                    }
                }
		    },
		    series: [{
		        data: harvestTotal,
		        type: 'line',
						symbol:'emptyCircle',
						symbolSize: 5,
						itemStyle: {
		        normal: {
		            color: "#fff",
		            lineStyle: {
		                color: "#fff"
		            }
		        }
		    	},
		    }]
		};
		myChart2.setOption(option)
		myChart2.on('datazoom',function(params){
		var opt = myChart2.getOption();
		var dz = opt.dataZoom[0];
		var s = harvestTotal[categories.indexOf(opt.xAxis[0].data[dz.startValue])+3];
			if((s+"").length>16){
				s=(s+"").slice(0, -16)+"亿亿"
			}else if((s+"").length>8&&(s+"").length<=16){
				s=(s+"").slice(0, -8)+"."+(s+"").slice(-8, -7)+"亿"
			}
		$("#dangricaishou").html(s+$("#shuru2").find("option:selected").text())
		});
	},
 error:function(e){
		api.alert({msg:"服务器异常，请联系管理员!"});
 }
});
}
function jidi(startDate,endDate,categoryId,farmId){
	  //alert("接收参数"+startDate+","+endDate+","+categoryId+","+farmId)
		pds.ajaxSubmit({
			url:'app/staff/farmland/land_list',
			data:{farmId:$("#landId").val()},
			success:function(ret,err){
			  //api.alert({msg:JSON.stringify(ret)});
				var dt=ret.data,l=dt.length,land="";
				if(!l){
				 $("#noPic3").show()
	 			 $("#container5").hide()
	 			 $("#dangricaishou").html(0+$("#shuru2").find("option:selected").text())
	 			 $("#shujuyuan").html("当日采收总量")
				 $("#today").html("单日最大采收量："+0+$("#shuru2").find("option:selected").text())
				 $("#todayTotal").html(0+$("#shuru2").find("option:selected").text())
				 return
			 }else {
				 $("#noPic3").hide()
  			 $("#container5").show()
			 }
				for(var i=0; i<l; i++){
					land+="<option value="+dt[i].id+">"+dt[i].name+"</option>"
				}
				$("#shuru1").html(land)
				danwei(startDate,endDate,categoryId,farmId,dt[0].id)
				land=null
			},
		 error:function(e){
				api.alert({msg:"服务器异常，请联系管理员!"});
		 }
	});
}
function danwei(startDate,endDate,categoryId,farmId,landId){
	//alert("单位参数"+startDate+","+endDate+","+categoryId+","+farmId+","+landId)
	//alert("app/harvestStat/units")
	pds.ajaxSubmit({
			url:'app/harvestStat/units',
			type : "GET",
			data:{startDate:startDate,endDate:endDate,categoryId:categoryId,farmId:farmId},
			success:function(ret,err){
			//api.alert({msg:JSON.stringify(ret)});
				var dt=ret.data,l=dt.length,land="";
				if(!l){
					$("#noPic1").show()
 				  $("#container1").hide()
					$("#noPic3").show()
					$("#container5").hide()
					$("#noPic2").show()
					$("#container2").hide()
					$("#shadowBar").hide()
					$("#dangricaishou").html(0+$("#shuru2").find("option:selected").text())
					$("#shujuyuan").html("当日采收总量")
					$("#today").html("单日最大采收量："+0+$("#shuru2").find("option:selected").text())
					$("#todayTotal").html(0+$("#shuru2").find("option:selected").text())
					$("#shuru2").html("")
					return
				}else {
					$("#noPic1").hide()
 				  $("#container1").show()
					$("#noPic3").hide()
					$("#shadowBar").show()
					$("#container5").show()
					$("#noPic2").hide()
					$("#container2").show()
				}
				for(var i=0; i<l; i++){
					land+="<option value="+dt[i].id+">"+dt[i].name+"</option>"
				}
				$("#shuru2").html(land)
				land=null
				//alert("接收单位数据")
				caiLiang(startDate,endDate,farmId,categoryId,dt[0].id,landId)
				nowHarvest(startDate,endDate,categoryId,farmId,dt[0].id,landId)
				pieFen(startDate,endDate,farmId,categoryId,dt[0].id,landId)
				priFen(startDate,endDate,farmId,categoryId,dt[0].id,landId)
			},
		 error:function(e){
				api.alert({msg:"服务器异常，请联系管理员!"});
		 }
	});
}
function nowHarvest(startDate,endDate,categoryId,farmId,numerator,landId){
	  //alert("当日最大采收参数"+startDate+","+endDate+","+farmId+","+categoryId+","+numerator+","+landId)
		pds.ajaxSubmit({
		 url:'app/harvestStat/queryHarvestData',
		 type : "GET",
		 data:{startDate:startDate,endDate:endDate,categoryId:categoryId,farmId:farmId,numerator:numerator,landId:landId},
		 success:function(ret,err){
			 //api.alert({msg:JSON.stringify(ret)});
			 ret.data.total=parseInt(ret.data.total)
			 if((ret.data.total+"").length>16){
				 ret.data.total=(ret.data.total+"").slice(0, -16)+"亿亿"
			 }else if((ret.data.total+"").length>8&&(ret.data.total+"").length<=16){
				 ret.data.total=(ret.data.total+"").slice(0, -8)+"."+(ret.data.total+"").slice(-8, -7)+"亿"
			 }
			//  else if((ret.data.total+"").length>4&&(ret.data.total+"").length<=8){
			// 	 ret.data.total=(ret.data.total+"").slice(0, -4)+"万"
			//  }
			 ret.data.max=parseInt(ret.data.max)
			 if((ret.data.max+"").length>16){
				 ret.data.max=(ret.data.max+"").slice(0, -16)+"亿亿"
			 }else if((ret.data.max+"").length>8&&(ret.data.max+"").length<=16){
				 ret.data.max=(ret.data.max+"").slice(0, -8)+"."+(ret.data.max+"").slice(-8, -7)+"亿"
			 }
			//  else if((ret.data.max+"").length>4&&(ret.data.max+"").length<=8){
			// 	 ret.data.max=(ret.data.max+"").slice(0, -4)+"万"
			//  }
			 $("#today").html("单日最大采收量："+ret.data.max+$("#shuru2").find("option:selected").text())
			 $("#todayTotal").html(ret.data.total+$("#shuru2").find("option:selected").text())
			 //$("#max").html(ret.data.max+$("#shuru2").find("option:selected").text())
		 },
		error:function(e){
			 api.alert({msg:"服务器异常，请联系管理员!"});
		}
 });
}
function jidiChange(){
	var startDate=$("#startDate").val(),endDate=$("#endDate").val(),categoryId=$("#catId").val(),farmId=$("#landId").val(),numerator=$("#shuru2").val(),landId=$("#shuru1").val()
	if(!(startDate&&endDate&&categoryId&&farmId&&numerator&&landId)){
		return
	}
	//salert(farmId)
	nowHarvest(startDate,endDate,categoryId,farmId,numerator,landId)
	caiLiang(startDate,endDate,farmId,categoryId,numerator,landId)
	pieFen(startDate,endDate,farmId,categoryId,numerator,landId)
	priFen(startDate,endDate,farmId,categoryId,numerator,landId)
}
//页面回到顶部
function scrollToTop(){
		var systemType = api.systemType;
		$("#wrapper").on("scroll",function(){
				var scrollTop = $("#wrapper").scrollTop();
				if(systemType!="ios"){
					if(scrollTop >= 223){
						$("#xuanxiang").addClass("you")
						$("#zhan").css("height","1rem")
					}else{
						$("#xuanxiang").removeClass("you")
						$("#zhan").css("height","0")
					}
			  }
				if(scrollTop >= 200){
						$("#body_totop_btn").show().off("click").on("click",function(){
								$("#wrapper").animate({'scrollTop': '0px'}, 1000);
								//myScroll.scrollTo(0, 0, 300)
								// $("#body_totop_btn").animate({'bottom': '10rem'}, 800,function(){
								// 		$("#body_totop_btn").css("bottom","0.5rem")
								// });
						})
				}else{
						$("#body_totop_btn").hide();
				}
		})
};
</script>
</body>
</html>
