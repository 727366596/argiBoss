<!DOCTYPE html>
<html lang="en">
<head>
		<meta http-equiv="Content-type" content="text/html; charset=utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
		<title>采收统计</title>
		<link rel="stylesheet" type="text/css" href="../../css/common/api.css">
		<script type="text/javascript" src="../../script/common/rem.js"></script>
		<link rel="stylesheet" href="../../css/common/public.css" />
    <style>
				article{
					position: absolute;
					padding-top: 0.2rem;
					padding-left: 0.2rem;
					padding-right: 0.2rem;
					padding-bottom: 0.6rem;
					background-color: #f3f4f4;
					left: 0;
					right: 0;
					top: 0;
					bottom: 0;
					overflow-y: auto;
					-webkit-overflow-scrolling:touch;
					z-index: 1;
				}
				section{
					margin-top: 0.2rem;
					background-color: #fff;
				}
				#section1{
					padding-top: 0.25rem;
					padding-bottom: 0.25rem;
					text-align: center;
				}
				#section2{
					margin-top: 0.3rem;
				}
				#section1 li{
					height: 0.8rem;
					line-height: 0.8rem;
					text-align: center;
				}
				#section1 li span{
					display: inline-block;
					font-size: 0.3rem;
					width: 1.7rem;
				  color: #666666;
				}
				input{
					font-size: 0.3rem;
					padding-top: 0.1rem;
					padding-bottom: 0.1rem;
					width: 3.4rem;
					padding-left: 0.1rem;
					color: #666666;
					background-color: #f3f4f4;
				}
				button{
					width: 5.7rem;
					height: 0.7rem;
					background-color: #00c558;
					color:#ffffff;
					font-size: 0.3rem;
					border-radius: 0.7rem;
					outline: 0;
				}
				.container1,.container2{
					width: 100%;
					height: 6rem;
					overflow: hidden;
				}
				#container1{
					/*margin-top: -20%;
					margin-left: -20%;
					width: 140%;
					height: 140%;*/
					width: 100%;
					height: 6rem;
				}
				#container5{
					/*margin-top: -20%;
					margin-left: -20%;
					width: 140%;
					height: 140%;*/
					width: 7.2rem;
					height: 6rem;
				}
				#container2{
					width: 100%;
					height: 6rem;
				}
				.container3{
					position: relative;
					margin-left: 0.2rem;
					width: 100%;
					height: 6rem;
				}
				/*.containerLeft{
					position: absolute;
					width: 0.8rem;
					height: 100%;
					overflow: hidden;
				}
				.containerRight{
					position: absolute;
					left: 0.8rem;
					width: 81%;
					height: 100%;
					overflow-x: scroll;
					overflow-y: hidden;
				}
				#container3{
					width: 20rem;
					height: 100%;
				}
				#container4{
					width: 20.8rem;
					height: 100%;
				}*/
				#part2{
					display: none;
				}
				.biaoTitle{
					padding: 0.2rem;
				}
				.titleContent{
					font-size: 0.3rem;
					text-align: center;
					height: 0.8rem;
					line-height: 0.8rem;
					background-color: #fafafa;
				}
				.xuanxiang{
					position: relative;
					border-bottom: 1px solid #f6f3f3;
					background-color: #fff;
				}
				.plantA{
					display: inline-block;;
					text-align: center;
					height: 1rem;
					line-height: 1rem;
					width: 48%;
					font-size: 0.3rem;
					color: #00c558;
				}
				.plantB{
					display: inline-block;
					height: 1rem;
					line-height: 1rem;
					text-align: center;
					width: 48%;
					font-size: 0.3rem;
					color: #333333;
				}
				#partA1{
					width: 1.6rem;
					height: 1px;
					margin-left: 0.95rem;
					background-color: #00c558;
				}
				#partA2{
					display: none;
					width: 1.8rem;
					height: 1px;
					margin-left: 0.85rem;
					background-color: #00c558;
				}
				.nianyue{
					text-align: center;
					height: 1rem;
					line-height: 1rem;
					font-size: 0.26rem;
					color: #374c4f;
					border-top: 1px solid #f6f3f3;
					border-bottom: 1px solid #f6f3f3;
				}
				.xuan{
					padding-top: 0.7rem;
					padding-bottom: 0.42rem;
					padding-left: 0.3rem;
				}
				.dikuai{
					display: inline-block;
					margin-right: -0.3rem;
					height: 0.3rem;
					line-height: 0.3rem;
					font-size: 0.28rem;
					text-align: right;
					color: #666;
				}
				.shuru{
					display: inline-block;
					position: relative;
				}
				.shuru1{
					display: inline-block;
					position: relative;
					padding-left: 0.2rem;
					width: 2.74rem;
					font-size: 0.28rem;
					color: #666;
				}
				.shuru2{
					display: inline-block;
					position: relative;
					padding-left: 0.2rem;
					width: 1.34rem;
					font-size: 0.28rem;
					color: #666;
				}
				select{
					display: inline-block;
					width: 1rem;
					height: 0.8rem;
					background-color: #fff;
	  			border: 1px solid #f6f3f3 !important;
	  		}
				i{
					position: absolute;
					top: 0.7rem;
					right: 0.2rem;
					width: 0.3rem;
					height: 0.3rem;
					background:url("../../image/planting/arrow.png") no-repeat center center;
					background-size: 80% 50%;
				}
				.shuju{
					margin-top: 0.7rem;
					height: 2.25rem;
					background-color: #fff;
				}
				.jihuashuju{
					display: inline-block;
					text-align: center;
					width: 48%;
					font-size: 0.6rem;
					color: #43c5f1;

				}
				.shijishuju{
					display: inline-block;
					text-align: center;
					width: 48%;
					font-size: 0.6rem;
					color: #374c4f;
					border-left: 1px solid #f6f3f3;
				}
				.shujuyuan{
					font-size: 0.34rem;
					color: #747976;
				}
				#body_totop_btn{
						position: fixed;
						bottom:0.5rem;
						right:0.2rem;
						width:1.2rem;
						height:1.2rem;
						z-index: 999;
						line-height: 2.25rem;
						font-size: 0.2rem;font-family: PingFangSC-Regular, sans-serif;color: #AEADAD;
						text-align: center;
						background: url("../../image/planting/top.png") no-repeat center 3px;
						background-size: 70% 70%;
						background-color: rgba(0,0,0,0);
						border-radius: 6px;
						font-size: 0.20rem;
						color: #20c714;
						display: none;
				}
				.you{
					position: fixed;
					top: 0;
					right: 0;
					left: 0;
					width: 100%;
					background-color: #fff;
					z-index: 9999;
				}
				#noPic1,#noPic2,#noPic3{
					display: none;
					width: 100%;
					height: 5.77rem;
				}
    </style>
</head>
<body>
<article id="wrapper">
    <section id="section1">
				<ul>
					<li>
						<span>哪个基地：</span>
						<input id="land"type="text" value="" readonly>
						<input id="landId" type="hidden">
					</li>
					<li>
						<span>统计时间：</span>
						<input id="time" type="text" value="" readonly>
						<input id="startDate" type="hidden">
						<input id="endDate" type="hidden">
					</li>
					<li>
						<span>种的作物：</span>
						<input id="crop" type="text" value="" readonly>
						<input id="catId" type="hidden">
					</li>
				</ul>
				<button id="select">点我选择</button>
    </section>
		<section>
			<div id="zhan"></div>
			<div id="xuanxiang" class="xuanxiang">
				<div id="partA" class="plantA">
					采收品类分布
					<span id="partA1"></span>
				</div>
				<div id="partB" class="plantB">
					采收量情况
					<span id="partA2"></span>
				</div>
			</div>
			<div id="part1">
			<div class="biaoTitle">
				<div class="titleContent">当日品类分布</div>
			</div>
			<div class="container1">
				<img id="noPic1" src="../../image/planting/noPic.png" alt="">
				<div id="container1"></div>
			</div>
			<div class="biaoTitle">
				<div class="titleContent">累积品类分布</div>
			</div>
			<div class="container2">
				<img id="noPic2" src="../../image/planting/noPic.png" alt="">
				<div id="container2"></div>
				</div>
			</div>
			<div id="part2">
				<div class="xuan">
					<span class="dikuai">地块：</span>
					<span class="shuru">
							<select id="shuru1" class="shuru1" onchange="jidiChange">
								<option value="">一大队2号地</option>
							</select>
							<i></i>
					</span>
					<span class="dikuai">采收单位：</span>
					<span class="shuru">
							<select id="shuru2" class="shuru2" onchange="danweiChange">
								<option value="">吨</option>
								<option value="">斤</option>
							</select>
							<i></i>
					</span>
				</div>
				<div class="biaoTitle">
					<div id="today" class="titleContent">当日最大采收量：500吨</div>
				</div>
				<div class="container1">
					<img id="noPic3" src="../../image/planting/noPic.png" alt="">
					<div id="container5"></div>
				</div>
				<p id="nianyue" class="nianyue"></p>
				<div class="shuju">
					<div class="jihuashuju">
						<span id="dangricaishou"></span>
						<span id="shujuyuan" class="shujuyuan">当日采收总量</span>
					</div>
					<div class="shijishuju">
						<span id="todayTotal"></span>
						<span class="shujuyuan">累计采收总量</span>
					</div>
				</div>
			</div>
		</section>
</article>
<div id="body_totop_btn">
    返回顶部
</div>
<script type="text/javascript" src="../../script/common/api.js"></script>
<script type="text/javascript" src="../../script/common/jquery.min.js"></script>
<script type="text/javascript" src="../../script/common/pds.ajax.js"></script>
<script type="text/javascript" src="../../script/planting/echarts.min.js"></script>
<!-- <script type="text/javascript" src="../../script/planting/highcharts.js"></script> -->

<script type="text/javascript" src="../../script/planting/fusioncharts.js"></script>
<script type="text/javascript" src="../../script/planting/fusioncharts.theme.fint.js"></script>
<script type="text/javascript" src="../../script/planting/fusioncharts.widgets.js"></script>

<!-- <script src="https://www.fusioncharts.com/lib/fcassets/3.12.2/fusioncharts.js"></script> -->


<script>

	apiready=function(){
		// var header = $api.byId('header');
		// 	$api.fixStatusBar(header);
		// 	var headerH = $api.offset(header).h;
		// 	$("body").css({"paddingTop":headerH+"px"});
			var show=1
			$("#partA").on("touchstart",function(){
				if(!show){
					show=1
					$("#partA").attr("class","plantA")
					$("#partB").attr("class","plantB")
					$("#part1").show()
					$("#part2").hide()
					$("#partA1").show()
					$("#partA2").hide()
				}
			})
			$("#partB").on("touchstart",function(){
				if(show){
					show=null
					$("#partA").attr("class","plantB")
					$("#partB").attr("class","plantA")
					$("#part1").hide()
					$("#part2").show()
					$("#partA2").show()
					$("#partA1").hide()
				}
			})
			$("#select").on("touchstart",function(){
					api.openWin({
						name : 'selectSearchTerm_win',
						url : './selectSearchTerm_win.html',
						pageParam: {
								pageId: 2
						}
					});
			})
			initIn()
			jidi()
			scrollToTop()
	}

	function initIn(){
		if($api.getStorage('harvest')){
			var startDate=$api.getStorage('startDates')
			var endDate=$api.getStorage('endDates')
			var farmId=$api.getStorage('farmIds')
			var categoryId=$api.getStorage('categoryIds')
			$("#time").val(startDate.replace(/\-/g, '.')+"-"+endDate.replace(/\-/g, '.'))
			$("#land").val($api.getStorage('landNames'))
			$("#crop").val($api.getStorage('categorys'))
			$("#landId").val(farmId)
			$("#catId").val(categoryId)
			$("#startDate").val(startDate)
			$("#endDate").val(endDate)
			$("#shuru1").val(farmId)
			// setTimeout(function(){
				pieFen(startDate,endDate,farmId,categoryId)
				priFen(startDate,endDate,farmId,categoryId)
				danwei(startDate,endDate,categoryId,farmId)
			// },300)
		}else{
			var d = new Date(), y = d.getFullYear(), m = d.getMonth() + 1, r = d.getDate();
			m < 10 ? m = "0" + m : m;
			r < 10 ? r = "0" + r : r;
			var endDate=y + "-" + m + "-" + r;
			var startDate=y + "-0" + 1 + "-0" + 1;
			$("#time").val(y+".01.01"+"-"+y + "." + m + "." + r)
			api.ajax({
				headers : {
						authorization : $api.getStorage("userId") == undefined? null : $api.getStorage("userId")
				},
				url:pds.defaultUri + 'app/commons/stat/firstEnterQueryParam',
			},function(ret,err){
				if (ret) {
					//alert(JSON.stringify(ret))
					$("#land").val(ret.data.farm.farmName)
					$("#crop").val(ret.data.category.catName)
					$("#landId").val(ret.data.farm.id)
					$("#catId").val(ret.data.category.id)
					$("#startDate").val(startDate)
					$("#endDate").val(endDate)
					// setTimeout(function(){
						pieFen(endDate,endDate,ret.data.farmId,ret.data.categoryId)
						priFen(startDate,endDate,ret.data.farmId,ret.data.categoryId)
						danwei(startDate,endDate,ret.data.categoryId,ret.data.farmId)
					// },300)
				} else {
					//api.alert({msg:JSON.stringify(err)});
				};
			});
		}
	}
	function pieFen(startDate,endDate,farmId,categoryId){
		api.ajax({
		 url:pds.defaultUri + 'app/harvestStat/queryGradeOfHarvest',
		 data:{values:{startDate:startDate,endDate:endDate,farmId:farmId,categoryId:categoryId}}
		},function(ret,err){
		 if (ret) {
			 //api.alert({msg:JSON.stringify(ret)});
			 if(!ret.data.length){
				 $("#noPic1").show()
				 $("#container1").hide()
				 return
			 }else{
				 $("#noPic1").hide()
				 $("#container1").show()
			 }
			 var gradeName=[],harvestTotal=[],color=['#FFC65C','#EE6B67','#32D6C5','#4198E1','#a1c345','#a864ab']
			 var date=ret.data,l=date.length;
			 for(var i=0;i<l;i++){
				 if(date[i].harvestTotal>10000||date[i].harvestTotal<3000){
					 continue
				 }
				 gradeName.push(date[i].gradeName)
				 harvestTotal.push({"value":date[i].harvestTotal,"name":date[i].gradeName})
				 if(l>5){
				 	color.push("rgb("+parseInt(Math.random()*257)+","+parseInt(Math.random()*257)+","+parseInt(Math.random()*257)+")")
				 }
			 }
				option1 = {
				    tooltip : {
				        trigger: 'item',
				        formatter: "<span style='z-index:0'>{a} <br/>{b} : {c} 吨({d}%)</span>"
				    },
						//color:['#FFC65C','#EE6B67','#32D6C5','#4198E1'],
						color:color,
				    visualMap: {
				        show: false,
				        min: 80,
				        max: 600,
				        inRange: {
				            colorLightness: [0, 1]
				        }
				    },
						legend: {
		         orient: 'vertical',
		         x: 'left',
		         data:gradeName
		       },
				    series : [
				        {
				            name:'采收品类分布',
				            type:'pie',
				            radius : '80%',
				            center: ['60%', '50%'],
				            data:harvestTotal.sort(function (a, b) { return a.value - b.value; }),
				            roseType: 'radius',
				            label: {
				                normal: {
															position: 'inner',
															formatter: "{c} 吨"
				                }
				            },
				            // labelLine: {
				            //     normal: {
				            //         smooth: 0.2,
				            //         length: 10,
				            //         length2: 20
				            //     }
				            // },
				            itemStyle: {
				                normal: {
				                    // color: '#c23531',
				                    shadowBlur: 150,
				                    shadowColor: 'rgba(0, 0, 0, 0.4)'
				                }
				            },

				            animationType: 'scale',
				            animationEasing: 'elasticOut',
				            animationDelay: function (idx) {
				                return Math.random() * 200;
				            }
				        }
				    ]
				};
				echarts.init(document.getElementById('container1')).setOption(option1)

			} else {
				//api.alert({msg:JSON.stringify(err)});
			}
		})
	}
	function priFen(startDate,endDate,farmId,categoryId){
		api.ajax({
		 url:pds.defaultUri + 'app/harvestStat/queryGradeOfHarvest',
		 data:{values:{startDate:startDate,endDate:endDate,farmId:farmId,categoryId:categoryId}}
		},function(ret,err){
		 if (ret) {
			 //api.alert({msg:JSON.stringify(ret)});
			 if(!ret.data.length){
					 $("#noPic2").show()
					 $("#container2").hide()
					 return
			 }else{
					 $("#noPic2").hide()
					 $("#container2").show()
			 }
			 var pri=[];
			 var date=ret.data,l=date.length;
			 var c=['0','1','2','3','4','5','6','7','8','9','A','B','C','D','E','F'];
      //  var color=['#ed6a66','#a864a8','#a1c345','#61d7c5','#3c81bf'];
			//  var ci=0;
			 for(var i=0;i<l;i++){
				 if(date[i].harvestTotal>10000||date[i].harvestTotal<3000){
					 continue
				 }
					 pri.push({
							 "value": date[i].harvestTotal,
							 "name": date[i].gradeName,

							 "cleanValue": date[i].harvestTotal
					 })
			 }
				FusionCharts.ready(function () {
						var myChart = new FusionCharts({
								type: "pyramid",
								renderAt: 'container2',
								width:'100%',
								height:'105%',
								dataFormat: 'json',
								dataSource: {
											"chart": {
													"bgcolor": "FFFFFF",
													"caption": "",
													"basefontcolor": "333333",
													"decimals": "0",
													"showToolTip":"0",
													"numbersuffix": "吨",
													"pyramidyscale": "50",
													"chartbottommargin": "20",
													"showborder": "0"
											},
											"data":pri.sort(function (a, b) { return a.value - b.value; })

									}
						});

						// Render the chart.
						myChart.render();
				});
			} else {
				//api.alert({msg:JSON.stringify(err)});
			}
		})
	}
function caiLiang(startDate,endDate,farmId,categoryId,numerator){
	api.ajax({
	 url:pds.defaultUri + 'app/harvestStat/queryAmountOfHarvest',
	 data:{values:{startDate:startDate,endDate:endDate,farmId:farmId,categoryId:categoryId,numerator:numerator}}
	},function(ret,err){
	 if (ret) {
		 //api.alert({msg:JSON.stringify(ret)});
		 if(!ret.data.length){
			 $("#noPic3").show()
			 $("#container5").hide()
			 return
			}else{
			 $("#noPic3").hide()
			 $("#container5").show()
			}
		 var categories=[],harvestTotal=[]
		 var date=ret.data,l=date.length
		 for(var i=0;i<l;i++){
			 categories.push(date[i].recordDate.substring(2,10))
			 harvestTotal.push(date[i].harvestTotal)
		 }
		 $("#nianyue").html(date[0].recordDate.substring(0,4)+"年"+date[0].recordDate.substring(5,7)+"月-"+date[l-1].recordDate.substring(0,4)+"年"+date[l-1].recordDate.substring(5,7)+"月")
		 //api.alert({msg:JSON.stringify(categories)});
		 option = {
			  backgroundColor: '#21bbef',
				grid:{
					x:40,
					y:20,
					x2:30,
					y2:45
				},
			  tooltip : {
						trigger: 'axis',
						axisPointer:{
										    type: 'line',
										    lineStyle: {
										        color: 'rgba(250,250,250,0.4)',
										        width: 34,
										        type: 'solid'
										    },
										    crossStyle: {
										        color: '#1e90ff',
										        width: 1,
										        type: 'dashed'
										    },
										    shadowStyle: {
										        color: 'rgba(150,150,150,0.3)',
										        width: 'auto',
										        type: 'default'
										    }
										},
					formatter:function (param) {
						//console.log(JSON.stringify(param))
						if((param[0].value+"").length>16){
							param[0].value=(param[0].value+"").slice(0, -16)+"亿亿"
						}else if((param[0].value+"").length>8&&(param[0].value+"").length<=16){
							param[0].value=(param[0].value+"").slice(0, -8)+"."+(param[0].value+"").slice(-8, -7)+"亿"
						}
						$("#dangricaishou").html(param[0].value+"吨")
						$("#shujuyuan").html(param[0].axisValue.substring(0,2)+"年"+param[0].axisValue.substring(3,5)+"月"+param[0].axisValue.substring(6,8)+"日"+"<br>"+"采收总量")
           }
				},
				dataZoom: [
					 {
							 show: false,
							 realtime: true,
							 handleColor: '#fff',
							 zoomLock:true,
							 showDetail: false,
							 borderColor:"#fff",
							 backgroundColor: '#ccc',
							 start: 80,
							 end: 100
					 },
					 {
							 type: 'inside',
							 realtime: true,
							 zoomLock:true,
							 start: 80,
							 end: 100
					 }
			 ],
		    xAxis: {
						splitLine:{show: false},
		        type: 'category',
		        data: categories,
						axisLine:{
									 lineStyle:{
											 color:'#fff',
											 width:1
									 }
						},
						axisLabel: {
						   interval:0,
						   rotate:-40
						}
		    },
		    yAxis: {
						//show:false,
						splitLine:{show: false},
		        type: 'log',
						axisLine:{
									 lineStyle:{
											 color:'#fff',
											 width:1
									 }
						},
						axisLabel:{
                    formatter: function (value) {
											value=value+""
											if(value.length<=3){
												return value
											}
											if(value.length>3&&value.length<=6){
												return value.slice(0, -3)+"k"
											}
											if(value.length>6&&value.length<=9){
												return value.slice(0, -6)+"m"
											}
											if(value.length>9&&value.length<=12){
												return value.slice(0, -9)+"b"
											}
											if(value.length>12&&value.length<=15){
												return value.slice(0, -12)+"t"
											}
											if(value.length>15&&value.length<=18){
												return value.slice(0, -15)+"p"
											}
                    }
                }
		    },
		    series: [{
		        data: harvestTotal,
		        type: 'line',
						symbol:'emptyCircle',
						symbolSize: 5,
						itemStyle: {
		        normal: {
		            color: "#fff",
		            lineStyle: {
		                color: "#fff"
		            }
		        }
		    	},
		    }]
		};
		echarts.init(document.getElementById('container5')).setOption(option)
	 } else {
		 //api.alert({msg:JSON.stringify(err)});
	 }
 })
}
function jidi(){
	api.ajax({
		headers : {
				authorization : $api.getStorage("userId") == undefined? null : $api.getStorage("userId")
		},
			url:pds.defaultUri + 'app/staff/farmland/get_farm_list',
		},function(ret,err){
			//api.alert({msg:JSON.stringify(ret)});
			if (ret) {
				var dt=ret.data,l=dt.length,land="";
				if(!l){
					return
				}
				for(var i=0; i<l; i++){
					land+="<option value="+dt[i].id+">"+dt[i].farmName+"</option>"
				}
				$("#shuru1").html(land)
				land=null
			} else {
			 api.alert({msg:JSON.stringify(err)});
		 }
	 })
}
function danwei(startDate,endDate,categoryId,farmId){
	api.ajax({
		headers : {
				authorization : $api.getStorage("userId") == undefined? null : $api.getStorage("userId")
		},
			url:pds.defaultUri + 'app/harvestStat/units',
			//data:{value:{categoryId:categoryId,farmId:farmId}},
		},function(ret,err){
			//api.alert({msg:JSON.stringify(ret)});
			if (ret) {
				var dt=ret.data,l=dt.length,land="";
				if(!l){
					return
				}
				for(var i=0; i<l; i++){
					land+="<option value="+dt[i].id+">"+dt[i].name+"</option>"
				}
				$("#shuru2").html(land)
				land=null
				caiLiang(startDate,endDate,farmId,categoryId,dt[0].id)
				nowHarvest(categoryId,farmId,dt[0].id)
			} else {
			 api.alert({msg:JSON.stringify(err)});
		 }
	 })
}
function nowHarvest(categoryId,farmId,numerator){
		api.ajax({
			headers : {
				authorization : $api.getStorage("userId") == undefined? null : $api.getStorage("userId")
		},
		 url:pds.defaultUri + 'app/harvestStat/queryHarvestData',
		 data:{values:{categoryId:categoryId,farmId:farmId,numerator:numerator}}
		},function(ret,err){
		 if (ret) {
			 //api.alert({msg:JSON.stringify(ret)});
			 if((ret.data.total+"").length>16){
				 ret.data.total=(ret.data.total+"").slice(0, -16)+"亿亿"
			 }else if((ret.data.total+"").length>8&&(ret.data.total+"").length<=16){
				 ret.data.total=(ret.data.total+"").slice(0, -8)+"."+(ret.data.total+"").slice(-8, -7)+"亿"
			 }
			//  else if((ret.data.total+"").length>4&&(ret.data.total+"").length<=8){
			// 	 ret.data.total=(ret.data.total+"").slice(0, -4)+"万"
			//  }
			 if((ret.data.max+"").length>16){
				 ret.data.max=(ret.data.max+"").slice(0, -16)+"亿亿"
			 }else if((ret.data.max+"").length>8&&(ret.data.max+"").length<=16){
				 ret.data.max=(ret.data.max+"").slice(0, -8)+"."+(ret.data.max+"").slice(-8, -7)+"亿"
			 }
			//  else if((ret.data.max+"").length>4&&(ret.data.max+"").length<=8){
			// 	 ret.data.max=(ret.data.max+"").slice(0, -4)+"万"
			//  }
			 $("#today").html("当日最大采收量："+ret.data.today+$("#shuru2").find("option:selected").text())
			 $("#todayTotal").html(ret.data.total+$("#shuru2").find("option:selected").text())
			 $("#max").html(ret.data.max+$("#shuru2").find("option:selected").text())
		 } else {
			 //api.alert({msg:JSON.stringify(err)});
		 }
	 })
}
function jidiChange(){
	nowHarvest($("#catId").val(),$("#shuru1").val(),$("#shuru2").val())
	caiLiang($("#startDate").val(),$("#endDate").val(),$("#shuru1").val(),$("#catId").val(),$("#shuru2").val())
}
function danweiChange(){
	nowHarvest($("#catId").val(),$("#shuru1").val(),$("#shuru2").val())
	caiLiang($("#startDate").val(),$("#endDate").val(),$("#shuru1").val(),$("#catId").val(),$("#shuru2").val())
}
//页面回到顶部
function scrollToTop(){
		var systemType = api.systemType;
		$("#wrapper").on("scroll",function(){
				var scrollTop = $("#wrapper").scrollTop();
				if(systemType!="ios"){
					if(scrollTop >= 223){
						$("#xuanxiang").addClass("you")
						$("#zhan").css("height","1rem")
					}else{
						$("#xuanxiang").removeClass("you")
						$("#zhan").css("height","0")
					}
			  }
				if(scrollTop >= 200){
						$("#body_totop_btn").show().off("click").on("click",function(){
								$("#wrapper").animate({'scrollTop': '0px'}, 1000);
								//myScroll.scrollTo(0, 0, 300)
								// $("#body_totop_btn").animate({'bottom': '10rem'}, 800,function(){
								// 		$("#body_totop_btn").css("bottom","0.5rem")
								// });
						})
				}else{
						$("#body_totop_btn").hide();
				}
		})
};
</script>
</body>
</html>
