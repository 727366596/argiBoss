<!DOCTYPE html>
<html lang="en">
<head>
		<meta http-equiv="Content-type" content="text/html; charset=utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
		<title>采收统计</title>
		<link rel="stylesheet" type="text/css" href="../../css/common/api.css">
		<script type="text/javascript" src="../../script/common/rem.js"></script>
		<link rel="stylesheet" href="../../css/common/public.css" />
		<link rel="stylesheet" href="../../css/common/header.css" />
    <style>
				article{
					padding-top: 0.2rem;
					padding-left: 0.2rem;
					padding-right: 0.2rem;
					padding-bottom: 0.6rem;
					background-color: #f3f4f4;
				}
				section{
					margin-top: 0.2rem;
					background-color: #fff;
				}
				#section1{
					padding-top: 0.25rem;
					padding-bottom: 0.25rem;
					text-align: center;
				}
				#section2{
					margin-top: 0.3rem;
				}
				#section1 li{
					height: 0.8rem;
					line-height: 0.8rem;
					text-align: center;
				}
				#section1 li span{
					display: inline-block;
					font-size: 0.3rem;
					width: 1.5rem;
				  color: #666666;
				}
				input{
					font-size: 0.3rem;
					padding-top: 0.1rem;
					padding-bottom: 0.1rem;
					width: 3.4rem;
					padding-left: 0.1rem;
					color: #666666;
					background-color: #f3f4f4;
				}
				button{
					width: 5.7rem;
					height: 0.7rem;
					background-color: #00c558;
					color:#ffffff;
					font-size: 0.3rem;
					border-radius: 0.7rem;
					outline: 0;
				}
				.container1,.container2{
					width: 100%;
					height: 6rem;
					overflow: hidden;
				}
				#container1{
					/*margin-top: -20%;
					margin-left: -20%;
					width: 140%;
					height: 140%;*/
					width: 100%;
					height: 100%;
				}
				#container2{
					width: 100%;
					height: 6rem;
				}
				.container3{
					position: relative;
					margin-left: 0.2rem;
					width: 100%;
					height: 6rem;
				}
				.containerLeft{
					position: absolute;
					width: 0.8rem;
					height: 6rem;
					overflow: hidden;
				}
				.containerRight{
					position: absolute;
					left: 0.8rem;
					width: 81%;
					height: 6rem;
					overflow-x: scroll;
				}
				#container3{
					width: 20rem;
					height: 6rem;
				}
				#container4{
					width: 20.8rem;
					height: 6rem;
				}
				#part2{
					display: none;
				}
				.biaoTitle{
					padding: 0.2rem;
				}
				.titleContent{
					font-size: 0.3rem;
					text-align: center;
					height: 0.8rem;
					line-height: 0.8rem;
					background-color: #fafafa;
				}
				.xuanxiang{
					border-bottom: 1px solid #f6f3f3;
				}
				.plantA{
					display: inline-block;;
					text-align: center;
					height: 1rem;
					line-height: 1rem;
					width: 48.25%;
					font-size: 0.3rem;
					color: #00c558;
				}
				.plantB{
					display: inline-block;
					height: 1rem;
					line-height: 1rem;
					text-align: center;
					width: 48.25%;
					font-size: 0.3rem;
					color: #333333;
				}
				#partA1{
					width: 1.6rem;
					height: 1px;
					margin-left: 0.95rem;
					background-color: #00c558;
				}
				#partA2{
					display: none;
					width: 1.8rem;
					height: 1px;
					margin-left: 0.85rem;
					background-color: #00c558;
				}
				.nianyue{
					text-align: center;
					height: 1rem;
					line-height: 1rem;
					font-size: 0.26rem;
					color: #374c4f;
					border-top: 1px solid #f6f3f3;
					border-bottom: 1px solid #f6f3f3;
				}
				.xuan{
					padding-top: 0.7rem;
					padding-bottom: 0.42rem;
					padding-left: 0.3rem;
				}
				.dikuai{
					display: inline-block;
					margin-right: -0.3rem;
					height: 0.3rem;
					line-height: 0.3rem;
					font-size: 0.28rem;
					text-align: right;
					color: #666;
				}
				.shuru{
					display: inline-block;
					position: relative;
				}
				.shuru1{
					display: inline-block;
					position: relative;
					padding-left: 0.2rem;
					width: 2.74rem;
					font-size: 0.28rem;
					color: #666;
				}
				.shuru2{
					display: inline-block;
					position: relative;
					padding-left: 0.2rem;
					width: 1.34rem;
					font-size: 0.28rem;
					color: #666;
				}
				select{
					display: inline-block;
					width: 1rem;
					height: 0.8rem;
					background-color: #fff;
	  			border: 1px solid #f6f3f3 !important;
	  		}
				i{
					position: absolute;
					top: 0.7rem;
					right: 0.2rem;
					width: 0.3rem;
					height: 0.3rem;
					background:url("../../image/planting/arrow.png") no-repeat center center;
					background-size: 80% 50%;
				}
				.shuju{
					margin-top: 0.7rem;
					height: 2.25rem;
					background-color: #fff;
				}
				.jihuashuju{
					display: inline-block;
					text-align: center;
					width: 48.25%;
					font-size: 0.6rem;
					color: #43c5f1;
					border-right: 1px solid #f6f3f3;
				}
				.shijishuju{
					display: inline-block;
					text-align: center;
					width: 48.25%;
					font-size: 0.6rem;
					color: #374c4f;
				}
				.shujuyuan{
					font-size: 0.34rem;
					color: #747976;
				}
    </style>
</head>
<body>
<div id="header">
        <div class="headerLeft" onclick="api.closeWin()"></div>
        <div class="headerCenter">采收统计</div>
        <div class="headerRight"></div>
</div>
<article>
    <section id="section1">
				<ul>
					<li>
						<span>哪个基地：</span>
						<input id="land"type="text" value="#1" readonly>
						<input id="landId" type="hidden">
					</li>
					<li>
						<span>统计时间：</span>
						<input id="time" type="text" value="2017年1月-2017年10月" readonly>
						<input id="startDate" type="hidden">
						<input id="endDate" type="hidden">
					</li>
					<li>
						<span>种的作物：</span>
						<input id="crop" type="text" value="玉米一号" readonly>
						<input id="catId" type="hidden">
					</li>
				</ul>
				<button id="select">点我选择</button>
    </section>
		<section>
			<div class="xuanxiang">
				<div id="partA" class="plantA">
					采收品类分布
					<span id="partA1"></span>
				</div>
				<div id="partB" class="plantB">
					采收量情况
					<span id="partA2"></span>
				</div>
			</div>
			<div id="part1">
			<div class="biaoTitle">
				<div class="titleContent">当日品类分布</div>
			</div>
			<div class="container1">
				<div id="container1"></div>
			</div>
			<div class="biaoTitle">
				<div class="titleContent">累积品类分布</div>
			</div>
			<div class="container2">
				<div id="container2"></div>
				</div>
			</div>
			<div id="part2">
				<div class="xuan">
					<span class="dikuai">地块：</span>
					<span class="shuru">
							<select id="shuru1" class="shuru1" onchange="jidiChange">
								<option value="">一大队2号地</option>
							</select>
							<i></i>
					</span>
					<span class="dikuai">采收单位：</span>
					<span class="shuru">
							<select id="shuru2" class="shuru2" onchange="danweiChange">
								<option value="">吨</option>
								<option value="">斤</option>
							</select>
							<i></i>
					</span>
				</div>
				<div class="biaoTitle">
					<div id="today" class="titleContent">当日最大采收量：500吨</div>
				</div>
				<div class="container3">
					<div  class="containerLeft">
						<div id="container3"></div>
					</div>
					<div  class="containerRight">
						<div id="container4"></div>
					</div>
				</div>
				<p id="nianyue" class="nianyue">2017年</p>
				<div class="shuju">
					<div class="jihuashuju">
						<span id="max" id="dangricaishou">330吨</span>
						<span class="shujuyuan">当日采收总量</span>
					</div>
					<div class="shijishuju">
						<span id="todayTotal">1500吨</span>
						<span class="shujuyuan">累计采收总量</span>
					</div>
				</div>
			</div>
		</section>
</article>
<script type="text/javascript" src="../../script/common/api.js"></script>
<script type="text/javascript" src="../../script/common/zepto-1.2.0.min.js"></script>
<script type="text/javascript" src="../../script/common/jquery.min.js"></script>
<script type="text/javascript" src="../../script/common/pds.ajax.js"></script>
<script src="https://cdn.bootcss.com/echarts/3.8.4/echarts.common.min.js"></script>

<script src="https://cdn.bootcss.com/highcharts/6.0.4/highcharts.js"></script>
<!-- <script src="https://img.hcharts.cn/highcharts/modules/variable-pie.js"></script>
<script src="https://img.hcharts.cn/highcharts/modules/funnel.js"></script> -->

<script src="https://www.fusioncharts.com/lib/fcassets/3.12.2/fusioncharts.js"></script>


<script>

	apiready=function(){
		var header = $api.byId('header');
			$api.fixStatusBar(header);
			var headerH = $api.offset(header).h;
			$("body").css({"paddingTop":headerH+"px"});
			var show=1
			$("#partA").on("touchstart",function(){
				if(!show){
					show=1
					$("#partA").attr("class","plantA")
					$("#partB").attr("class","plantB")
					$("#part1").show()
					$("#part2").hide()
					$("#partA1").show()
					$("#partA2").hide()
				}
			})
			$("#partB").on("touchstart",function(){
				if(show){
					show=null
					$("#partA").attr("class","plantB")
					$("#partB").attr("class","plantA")
					$("#part1").hide()
					$("#part2").show()
					$("#partA2").show()
					$("#partA1").hide()
				}
			})
			$("#select").on("touchstart",function(){
					api.openWin({
						name : 'selectSearchTerm_win',
						url : './selectSearchTerm_win.html',
						pageParam: {
								pageId: 1
						}
					});
			})
			initIn()
			jidi()
	}

	function initIn(){
		if($api.getStorage('harvest')){
			var startDate=$api.getStorage('startDates')
			var endDate=$api.getStorage('endDates')
			var farmId=$api.getStorage('farmIds')
			var categoryId=$api.getStorage('categoryIds')
			$("#time").val(startDate.substring(0,4)+"年"+startDate.substring(5,7)+"月-"+endDate.substring(0,4)+"年"+endDate.substring(5,7)+"月")
			$("#land").val($api.getStorage('landNames'))
			$("#crop").val($api.getStorage('categorys'))
			$("#startDate").val(startDate)
			$("#endDate").val(endDate)
			$("#shuru1").val(farmId)
			pieFen(startDate,endDate,farmId,categoryId)
			priFen(startDate,endDate,farmId,categoryId)
			danwei(startDate,endDate,categoryId,farmId)
		}else{
			var d = new Date(), y = d.getFullYear(), m = d.getMonth() + 1, r = d.getDate();
			m < 10 ? m = "0" + m : m;
			r < 10 ? r = "0" + r : r;
			var endDate=y + "-" + m + "-" + r;
			var startDate=y + "-0" + 1 + "-0" + 1;
			$("#time").val(y+"年0"+1+"月-"+y+"年"+m+"月")
			api.ajax({
				url:pds.defaultUri + 'app/crop/firstEnterCondition',
			},function(ret,err){
				if (ret) {
					if(!ret.data.land){
						return
					}
					$("#land").val(ret.data.farmId)
					$("#crop").val(ret.data.categoryName)
					$("#landId").val(ret.data.farmName)
					$("#catId").val(ret.data.categoryId)
					$("#startDate").val(startDate)
					$("#endDate").val(endDate)
					pieFen(endDate,endDate,ret.data.farmId,ret.data.categoryId)
					priFen(startDate,endDate,ret.data.farmId,ret.data.categoryId)
					danwei(startDate,endDate,ret.data.categoryId,ret.data.farmId)
				} else {
					//api.alert({msg:JSON.stringify(err)});
				};
			});
		}
	}
	function pieFen(startDate,endDate,farmId,categoryId){
		api.ajax({
		 url:pds.defaultUri + 'app/harvestStat/queryGradeOfHarvest',
		 //data:{values:{startDate:startDate,endDate:endDate,farmId:farmId,categoryId:categoryId}}
		},function(ret,err){
		 if (ret) {
			 //api.alert({msg:JSON.stringify(ret)});
			 var gradeName=[],harvestTotal=[],color=['#FFC65C','#EE6B67','#32D6C5','#4198E1','#a1c345','#a864ab']
			 var date=ret.data,l=date.length;
			 for(var i=0;i<l;i++){
				 if(date[i].harvestTotal>10000||date[i].harvestTotal<3000){
					 continue
				 }
				 gradeName.push(date[i].gradeName)
				 harvestTotal.push({"value":date[i].harvestTotal,"name":date[i].gradeName})
				 if(l>5){
				 	color.push("rgb("+parseInt(Math.random()*257)+","+parseInt(Math.random()*257)+","+parseInt(Math.random()*257)+")")
				 }
			 }
				option1 = {
				    tooltip : {
				        trigger: 'item',
				        formatter: "{a} <br/>{b} : {c} 吨({d}%)"
				    },
						//color:['#FFC65C','#EE6B67','#32D6C5','#4198E1'],
						color:color,
				    visualMap: {
				        show: false,
				        min: 80,
				        max: 600,
				        inRange: {
				            colorLightness: [0, 1]
				        }
				    },
						legend: {
		         orient: 'vertical',
		         x: 'left',
		         data:gradeName
		       },
				    series : [
				        {
				            name:'采收品类分布',
				            type:'pie',
				            radius : '80%',
				            center: ['60%', '50%'],
				            data:harvestTotal.sort(function (a, b) { return a.value - b.value; }),
				            roseType: 'radius',
				            label: {
				                normal: {
															position: 'inner',
															formatter: "{c} 吨"
				                }
				            },
				            // labelLine: {
				            //     normal: {
				            //         smooth: 0.2,
				            //         length: 10,
				            //         length2: 20
				            //     }
				            // },
				            itemStyle: {
				                normal: {
				                    // color: '#c23531',
				                    shadowBlur: 150,
				                    shadowColor: 'rgba(0, 0, 0, 0.4)'
				                }
				            },

				            animationType: 'scale',
				            animationEasing: 'elasticOut',
				            animationDelay: function (idx) {
				                return Math.random() * 200;
				            }
				        }
				    ]
				};
				echarts.init(document.getElementById('container1')).setOption(option1)

			} else {
				api.alert({msg:JSON.stringify(err)});
			}
		})
	}
	function priFen(startDate,endDate,farmId,categoryId){
		api.ajax({
		 url:pds.defaultUri + 'app/harvestStat/queryGradeOfHarvest',
		 //data:{values:{startDate:startDate,endDate:endDate,farmId:farmId,categoryId:categoryId}}
		},function(ret,err){
		 if (ret) {
			 //api.alert({msg:JSON.stringify(ret)});
			 var pri=[];
			 var date=ret.data,l=date.length;
			 var c=['0','1','2','3','4','5','6','7','8','9','A','B','C','D','E','F'];
      //  var color=['#ed6a66','#a864a8','#a1c345','#61d7c5','#3c81bf'];
			//  var ci=0;
			 for(var i=0;i<l;i++){
				 if(date[i].harvestTotal>10000||date[i].harvestTotal<3000){
					 continue
				 }
				//  if(ci>4){
				// 	 var col=""
				// 	 for(var j=0;j<6;j++){
				// 		 col+=c[parseInt(Math.random()*16)]
				// 	 }
					 pri.push({
							 "value": date[i].harvestTotal,
							 "name": date[i].gradeName,

							 "cleanValue": date[i].harvestTotal
					 })
					//  col=null
				//  }else{
				// 	 alert(color[ci])
				// 	 pri.push({
				// 			 "value": date[i].harvestTotal,
				// 			 "name": date[i].gradeName,
				// 			 "color": color[ci],
				// 			 "cleanValue": date[i].harvestTotal
				// 	 })
				// 	 ci++
				//  }
			 }
				FusionCharts.ready(function () {
						var myChart = new FusionCharts({
								type: "pyramid",
								renderAt: 'container2',
								width:'100%',
								height:'105%',
								dataFormat: 'json',
								dataSource: {
											"chart": {
													"bgcolor": "FFFFFF",
													"caption": "",
													"basefontcolor": "333333",
													"decimals": "0",
													"showToolTip":"0",
													"numbersuffix": "吨",
													"pyramidyscale": "50",
													"chartbottommargin": "20",
													"showborder": "0"
											},
											"data":pri.sort(function (a, b) { return a.value - b.value; })
											// "data": [
											// 		{
											// 				"value": "40",
											// 				"name": "出口",
											// 				"color": "ED6A66",
											// 				"cleanValue": 40
											// 		},
											// 		{
											// 				"value": "80",
											// 				"name": "5量以上",
											// 				"color": "A864A8",
											// 				"cleanValue": 80
											// 		},
											// 		{
											// 				"value": "100",
											// 				"name": "3-4量",
											// 				"color": "A1C345",
											// 				"issliced": "1",
											// 				"cleanValue": 100
											// 		},
											// 		{
											// 				"value": "120",
											// 				"name": "2-3量",
											// 				"color": "61D7C5",
											// 				"cleanValue": 120
											// 		},
											// 		{
											// 				"value": "160",
											// 				"name": "1-2量",
											// 				"color": "3C81BF",
											// 				"cleanValue": 160
											// 		}
											// ]
									}
						});

						// Render the chart.
						myChart.render();
				});
			} else {
				api.alert({msg:JSON.stringify(err)});
			}
		})
	}
	// Highcharts.setOptions({
	// 		colors: ['#3C81BF', '#61D7C5', '#A1C345', '#A864A8', '#ED6A66']
	// });
	// $('#container1').highcharts({
	// 	  credits: { enabled: false },
	//     chart: {
	//         type: 'variablepie',
	//     },
	//     title: {
	//         text: ''
	//     },
	//     tooltip: {
	//         headerFormat: '',
	//         pointFormat: '<span style="color:{point.color}">\u25CF</span> <b> {point.name}</b><br/>' +
	//         '产量: <b>{point.y}吨</b><br/>'
	//     },
	// 		plotOptions: {
	// 				 series: {
	// 					 allowPointSelect: true, //选中某块区域是否允许分离
	// 					 cursor: 'pointer',
	// 					 dataLabels: {
	// 							enabled: true //是否直接呈现数据 也就是外围显示数据与否
	// 					 },
	// 					 showInLegend: true
	// 				 }
	// 		 },
	// 		series: [{
  //       minPointSize: 10,
  //       // innerSize: '20%',
  //       zMin: 0,
  //       name: '重量',
  //       data: [{
  //           name: '5量',
  //           y: 50,
	// 					color:'#FFC65C',
  //           z: 2
  //       }, {
  //           name: '3-4量',
  //           y: 100,
	// 					color:'#EE6B67',
  //           z: 3
  //       }, {
  //           name: '1-2量',
  //           y: 100,
	// 					color:'#32D6C5',
  //           z: 4
  //       }, {
  //           name: '1量以下',
  //           y: 150,
	// 					color:'#4198E1',
  //           z: 5
  //       }]
  //   }]
	//  });
	//  $('#container2').highcharts({
	// 	    credits: { enabled: false },
  //       chart: {
  //           type: 'pyramid',
  //       },
  //       title: {
  //           text: '',
  //           x: -50
  //       },
  //       plotOptions: {
  //           series: {
  //               dataLabels: {
  //                   enabled: true,
  //                   format: '<b>{point.name} {point.y}吨</b>',
  //                   color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black',
  //                   softConnector: true
  //               }
  //           }
  //       },
  //       legend: {
  //           enabled: false
  //       },
  //       series: [{
  //           name: '总量',
  //           data: [
  //               ['1-2量', 100],
  //               ['2-3量', 90],
  //               ['3-4量', 80],
  //               ['4-5量', 70],
  //               ['5量以上',60]
  //           ]
  //       }]
  //   });

function caiLiang(startDate,endDate,farmId,categoryId,numerator){
	api.ajax({
	 url:pds.defaultUri + 'app/harvestStat/queryAmountOfHarvest',
	 //data:{values:{startDate:startDate,endDate:endDate,farmId:farmId,categoryId:categoryId,numerator:numerator}}
	},function(ret,err){
	 if (ret) {
		 //api.alert({msg:JSON.stringify(ret)});
		 var categories=[],harvestTotal=[]
		 var date=ret.data,l=date.length
		 for(var i=0;i<l;i++){
			 categories.push(date[i].recordDate)
			 harvestTotal.push(date[i].harvestTotal)
		 }
		 $("#nianyue").html(date[0].recordDate.substring(0,4)+"年"+date[0].recordDate.substring(5,7)+"月-"+date[l-1].recordDate.substring(0,4)+"年"+date[l-1].recordDate.substring(5,7)+"月")
		 //api.alert({msg:JSON.stringify(categories)});
		 $('#container3').highcharts({
			 credits: {
						enabled: false
			 },
			 chart: {
					 type: 'area',
					 spacingTop: 30,
					 backgroundColor:"#21bbef",
			 },
			 title: {
					 text: ''
			 },
			 xAxis: {
					 tickmarkPlacement: 'on',
					 tickPosition: 'inside',
					 lineColor:'#fff',
					 tickColor:'#fff',
					 zIndex:100,
					 title: {
							 text: ''
					 },
					 categories: categories,
					labels: {
									//rotation: 45,
									style: {
											fontSize: '0.26rem',
											color:"#fff"
									},
									formatter: function () {
									 return this.value.substring(8,10);
							   }
							}
			 },
			 yAxis: {
					 min: 0,
					 lineColor:'#fff',
					 tickmarkPlacement: 'on',
					 gridLineWidth:0,
					 tickWidth:1,
					 lineWidth:1,
					 tickColor:'#fff',
					 title: {
							 text: ''
					 },
					 labels: {
							 style: {
									 fontSize: '0.26rem',
									 color:'#fff',
									 fontFamily: 'Verdana, sans-serif',
						 }
					 }
			 },
			 tooltip: {
					 crosshairs: true,
					 crosshairs:[{
						 width:28,
						 color:"rgba(250,250,250,0.2)",
						 zIndex: 100
					 }],

					 shared: true
			 },
			 plotOptions: {
					 spline: {
							 marker: {
									 radius: 4,
									 lineColor: '#666666',
									 lineWidth: 1
							 }
					 },
					 area: {
							stacking: 'normal',
							lineColor: '#666666',
							lineWidth: 1,
							marker: {
									lineWidth: 1,
									lineColor: '#fff'
							}
					}

			 },
			 series: [{
					 name: '一号地块',
					 marker: {
							 symbol: 'circle',
					 },
					 showInLegend: false,//不显示图例
					 //data: [30,45,55,70,90,110,200,300,320,280,230,180,30,45,55,70,90,110,200,300,320,280,230,180,30,45,55,70,90,110,200],
					 data:harvestTotal,
					 color:'#21bbef',
					 lineColor: '#fff'
			 }]
		 });

		 $('#container4').highcharts({
			 credits: {
						enabled: false
			 },
			 chart: {
					 type: 'area',
					 spacingTop: 30,
					 backgroundColor:"#21bbef",
					 spacingLeft:0,
					 spacingRight: 50
			 },
			 title: {
					 text: ''
			 },
			 xAxis: {
					 tickmarkPlacement: 'on',
					 tickPosition: 'inside',
					 lineColor:'#fff',
					 tickColor:'#fff',
					 zIndex:100,
					 title: {
							 text: ''
					 },
					 categories: categories,
					labels: {
									//rotation: 45,
									style: {
											fontSize: '0.26rem',
											color:"#fff"
									},
									formatter: function () {
									 return this.value.substring(8,10);
							   }
							}
			 },
			 yAxis: {
				 tickmarkPlacement: 'on',
				 gridLineWidth:0,
				 title: {
						 text: ''
				 },
					labels:{
							enabled: false
					}
			 },
			 tooltip: {
					 crosshairs: true,
					 crosshairs:[{
						 width:28,
						 color:"rgba(250,250,250,0.2)",
						 zIndex: 100
					 }],

					 shared: true
			 },
			 plotOptions: {
					 spline: {
							 marker: {
									 radius: 4,
									 lineColor: '#666666',
									 lineWidth: 1
							 },
					 },
					 area: {
							stacking: 'normal',
							lineColor: '#666666',
							lineWidth: 1,
							marker: {
									lineWidth: 1,
									lineColor: '#fff'
							}
					}

			 },
			 series: [{
					 name: '一号地块',
					 // events: {
					 // 		 click: function(e) {
					 // 				 $("#dangricaishou").html(e.point.y+"吨");
					 // 		 }
					 //  },
					 marker: {
							 symbol: 'circle',
					 },
					 showInLegend: false,//不显示图例
					 //data: [30,45,55,70,90,110,200,300,320,280,230,180,30,45,55,70,90,110,200,300,320,280,230,180,30,45,55,70,90,110,200],
					 data:harvestTotal,
					 color:'#21bbef',
					 lineColor: '#fff'
			 }]
		 });
	 } else {
		 api.alert({msg:JSON.stringify(err)});
	 }
 })
}
function jidi(){
	api.ajax({
		headers : {
				authorization : $api.getStorage("userId") == undefined? null : $api.getStorage("userId")
		},
			url:pds.defaultUri + 'app/staff/farmland/get_farm_list',
		},function(ret,err){
			//api.alert({msg:JSON.stringify(ret)});
			if (ret) {
				var dt=ret.data,l=dt.length,land="";
				if(!l){
					return
				}
				for(var i=0; i<l; i++){
					land+="<option value="+dt[i].id+">"+dt[i].farmName+"</option>"
				}
				$("#shuru1").html(land)
				land=null
			} else {
			 api.alert({msg:JSON.stringify(err)});
		 }
	 })
}
function danwei(startDate,endDate,categoryId,farmId){
	api.ajax({
		headers : {
				authorization : $api.getStorage("userId") == undefined? null : $api.getStorage("userId")
		},
			url:pds.defaultUri + 'argi/app/harvestStat/units',
			data:{value:{categoryId:categoryId,farmId:farmId}},
			method:"get"
		},function(ret,err){
			//api.alert({msg:JSON.stringify(ret)});
			if (ret) {
				var dt=ret.data,l=dt.length,land="";
				if(!l){
					return
				}
				for(var i=0; i<l; i++){
					land+="<option value="+dt[i].id+">"+dt[i].name+"</option>"
				}
				$("#shuru2").html(land)
				land=null
				caiLiang(startDate,endDate,farmId,categoryId,dt[0].id)
				nowHarvest(categoryId,farmId,dt[0].id)
			} else {
			 api.alert({msg:JSON.stringify(err)});
		 }
	 })
}
function nowHarvest(categoryId,farmId,numerator){
		api.ajax({
			headers : {
				authorization : $api.getStorage("userId") == undefined? null : $api.getStorage("userId")
		},
		 url:pds.defaultUri + 'argi/app/harvestStat/queryHarvestData',
		 //data:{values:{categoryId:categoryId,farmId:farmId,numerator:numerator}}
		},function(ret,err){
		 if (ret) {
			 //api.alert({msg:JSON.stringify(ret)});
			 if((ret.data.total+"").length>16){
				 ret.data.total=(ret.data.total+"").slice(0, -16)+"亿亿"
			 }else if((ret.data.total+"").length>8&&(ret.data.total+"").length<=16){
				 ret.data.total=(ret.data.total+"").slice(0, -8)+"."+(ret.data.total+"").slice(-8, -7)+"亿"
			 }
			//  else if((ret.data.total+"").length>4&&(ret.data.total+"").length<=8){
			// 	 ret.data.total=(ret.data.total+"").slice(0, -4)+"万"
			//  }
			 if((ret.data.max+"").length>16){
				 ret.data.max=(ret.data.max+"").slice(0, -16)+"亿亿"
			 }else if((ret.data.max+"").length>8&&(ret.data.max+"").length<=16){
				 ret.data.max=(ret.data.max+"").slice(0, -8)+"."+(ret.data.max+"").slice(-8, -7)+"亿"
			 }
			//  else if((ret.data.max+"").length>4&&(ret.data.max+"").length<=8){
			// 	 ret.data.max=(ret.data.max+"").slice(0, -4)+"万"
			//  }
			 $("#today").html("当日最大采收量："+ret.data.today+$("#shuru2").find("option:selected").text())
			 $("#todayTotal").html(ret.data.total+$("#shuru2").find("option:selected").text())
			 $("#max").html(ret.data.max+$("#shuru2").find("option:selected").text())
		 } else {
			 api.alert({msg:JSON.stringify(err)});
		 }
	 })
}
function jidiChange(){
	nowHarvest($("#catId").val(),$("#shuru1").val(),$("#shuru2").val())
	caiLiang($("#startDate").val(),$("#endDate").val(),$("#shuru1").val(),$("#catId").val(),$("#shuru2").val())
}
function danweiChange(){
	nowHarvest($("#catId").val(),$("#shuru1").val(),$("#shuru2").val())
	caiLiang($("#startDate").val(),$("#endDate").val(),$("#shuru1").val(),$("#catId").val(),$("#shuru2").val())
}
</script>
</body>
</html>
