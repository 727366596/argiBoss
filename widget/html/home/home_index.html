<!DOCTYPE html>
<html>
<head>
	<title></title>
	<meta charset="utf-8">
	<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
	<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
	<script type="text/javascript" src="../../script/common/rem.js"></script>
	<link rel="stylesheet" type="text/css" href="../../css/common/reset.css">
	<link rel="stylesheet" type="text/css" href="../../css/common/api.css"/>
	<link rel="stylesheet" type="text/css" href="../../css/common/swiper.min.css">
	<style type="text/css">
			.fixed-top{
				position: fixed;
				top: 0;
				left: 0;
				right: 0;
				width: 100%;
				height: 0.4rem;
				background: #204e41;
				z-index: 999999;
			}
			.content{
				width: 100%;
				overflow: hidden;
				font-size: 0.25rem;
				color: #204e41;
		    padding-top: 0.4rem;
		    box-sizing: border-box;
			}
			.top{
				width: 100%;
				background: #204e41;
				overflow: hidden;
			}
			/*轮播*/
			.banner{
				width: 100%;
				height: 3.48rem;
			}
			.swiper-container,.swiper-wrapper,.swiper-slide,.swiper-slide img{
				width: 100%;
				height: 100%;
			}
			.swiper-pagination{
				bottom: 0.3rem;
				background: none!important;
			}
			.swiper-pagination span{
				display: inline-block;
				width: 0.2rem;
				height: 0.2rem;
			}
			/*公告*/
			.notoce-banner{
				width: 100%;
				height: 1rem;
				padding-top: 0.38rem;
				color: #fff;
				font-size: 0.24rem;
				overflow: hidden;
			}
			.notoce-banner img{
				width: 0.74rem;
				height: 0.28rem;
				float: left;
			}
			.notoce-banner .swiper-container{
				display: inline-block;
		    width: 4.35rem;
				float: left;
			}
			.notoce-banner .title{
				float: left;
				margin:0 0.15rem;
			}
			.notoce-banner-more{
				float: left;
				margin-right: 0.15rem;
				font-size: 0.23rem;
			}
			.center{
				width: 100%;
				overflow: hidden;
				background: #dadada;
			}
			/*天气*/
			.weather{
				width: 100%;
				padding: 0.4rem 1.84rem 0.49rem 1.85rem;
				box-sizing: border-box;
				overflow: hidden;
				border-bottom: 1px solid #ccc;
			}
			.weather-img,.weather-text,.weather-temperature{
				float: left;
				text-align: center;
			}
			.weather .weather-img img{
				width: 0.4rem;
				height: 0.4rem;
			}
			.weather .weather-text{
				width: 1.6rem;
				height: 0.7rem;
				border-left:1px solid #204e41;
				border-right:1px solid #204e41;
				margin: 0 0.4rem;
			}
			/*页面跳转*/
			.jump-page{
				width: 100%;
				height: 5.9rem;
				overflow: hidden;
				padding: 0.63rem 0.73rem 0;
				box-sizing: border-box;
				border-top: 1px solid #fff;
				border-bottom: 1px solid #ccc;
				background: url(../../image/home/jump-page-back.png)no-repeat center 2.82rem;
				background-size:5.53rem 2.46rem;
			}
			.jump-page .page-item{
				width: 1.34rem;
				height: 2.4rem;
				margin-right: 0.22rem;
				float: left;
			}
			.jump-page .page-item img{
				width: 100%;
				height:100%;
			}
			.jump-page :nth-child(4){
				margin-right: 0;
				height: 2.55rem;
			}
			.jump-page :nth-child(2){
				height: 2.51rem;
			}
			.jump-page :nth-child(3){
				height: 3.24rem;
			}
			/*技术推广列表*/
			.list{
				width: 100%;
				overflow: hidden;
				padding: 0.65rem 0 0.6rem;
				box-sizing: border-box;
				border-top: 1px solid #fff;
			}
			.list .top-title{
				width: 100%;
				overflow: hidden;
				margin-bottom: 0.62rem;
			}
			.list .back-img-l{
				width: 2.96rem;
				height: 0.3rem;
				float: left;
			}
			.list .top-title img{
				width:100%;
				height: 93%;
			}
			.list .back-img-r{
				width: 2.96rem;
				height: 0.3rem;
				float: right;
				position: relative;
			}
			.list .back-img-r .more{
				position: absolute;
				right: 0.8rem;
		    bottom: 0;
				font-size: 0.23rem;
				z-index: 999;
			}
			.list .list-title{
				float: left;
				margin-left: 0.2rem;
				font-size: 0.3rem;
				margin-top: -0.018rem;
			}
			.list .list-content{
				width: 100%;
				overflow: hidden;
				padding: 0 0.5rem 0.5rem 0.47rem;
				box-sizing: border-box;
			}
			.list-content .list-item:last-child{
				border-top:none;
			}
			.list-content .list-item{
				width: 100%;
				overflow: hidden;
				padding: 0.26rem 0 0.26rem 0.01rem;
				box-sizing: border-box;
				border-bottom:1px solid #204e41;
				border-top:1px solid #204e41;
			}
			.list-content .list-item .left{
				width: 4.32rem;
				padding-right: 0.2rem;
				box-sizing: border-box;
				float: left;
			}
			.list-content .list-item .left .title{
				width: 100%;
				text-overflow: ellipsis;
				overflow: hidden;
				white-space: nowrap;
				line-height: 0.8rem;
				font-size: 0.28rem;
			}
			.list-content .list-item .left .type{
				float: left;
				font-size: 0.2rem;
			}
			.list-content .list-item .left .date{
				float: right;
				font-size: 0.2rem;
			}
			.list-content .list-item .right{
				width: 2.2rem;
				height: 1.25rem;
				float: right;
			}
			.list-content .list-item .right img{
				width: 100%;
				height: 100%;
			}
			.noticeContent{
				display: none;
			}
			.noticeTitle{
				overflow: hidden;
				text-overflow: ellipsis;
				white-space: nowrap;
			}
			.more-list{
				position: absolute;
				right: 26%;
				top: -2px;
			}
	</style>

</head>
<body>

	<div class="content">
		<div class="top">
			<div class="fixed-top"></div>
			<!-- 轮播 -->
			<div class="banner">
				<div class="swiper-container" id="bannerContainer">
					<div class="swiper-wrapper" id="banner">
					</div>
					<!-- 分页器 -->
					<div class="swiper-pagination" ></div>
				</div>
			</div>

			<!-- 公告 -->
			<div class="notoce-banner">
				<img src="../../image/home/notice-l.png" alt="">
				<span class="title">公告：</span>
				<div class="swiper-container" id="noticeTitle">
					<div class="swiper-wrapper">
					<!-- <div class="swiper-slide"><div>系统公告张珊珊来教导处下</div><div></div></div> -->
				</div>
				</div>
				<div class="notoce-banner-more" id="noticeListMore">更多</div>
				<img style="float:right;" src="../../image/home/notice-r.png" alt="">
			</div>

		</div>

		<div class="center">
			<!-- 天气 -->
			<div class="weather">
					<div class="weather-img">
					</div>
					<div class="weather-text">
						<div class="weather-city"><span id="weather_city"></span><span id="weather_area"></span></div>
						<div class="weather-condition" id="weather_text"></div>
					</div>
					<div class="weather-temperature">
						<div class="temperature-now" id="now_temp"></div>
						<div class="temperature-today"  id="all_temp"></div>
					</div>
			</div>

			<!-- 页面跳转 -->
			<div class="jump-page">
				<div class="page-item" id="openMarketInfo" onclick="openMarketInfo()">
						<img src="../../image/home/mark.png" alt="">
				</div>
				<div class="page-item" id="analysis" onclick="analysis()">
						<img src="../../image/home/people.png" alt="">
				</div>
				<div class="page-item" id="openPlant"  onclick="openPlant()">
					<img src="../../image/home/plant.png" alt="">
				</div>
				<div class="page-item"  id="openCall" onclick="openCall()">
						<img src="../../image/home/ask.png" alt="">
				</div>
			</div>

			<!-- 列表 -->
			<div class="list">
				<div class="top-title">
					<div class="back-img-l">
						<img src="../../image/home/list-left.png" alt="">
					</div>
					<div class="list-title">技术推广</div>
					<div class="back-img-r">
							<img src="../../image/home/list-right.png" alt="">
							<div class="more-list"  id="gotolist">更多</div>

					</div>
				</div>
				<div class="list-content">
				</div>

			</div>
		</div>
	</div>


</body>
<script type="text/javascript" src="../../script/common/api.js"></script>
<script type="text/javascript" src="../../script/common/jquery.min.js"></script>
<script type="text/javascript" src="../../script/common/pds.ajax.js"></script>
<script type="text/javascript" src="../../script/common/swiper.min.js"></script>

<script type="text/javascript">

	apiready=function(){
		api.addEventListener({
		    name: 'backHome'
		}, function(ret, err){
		    if( ret ){
					$('#openPlant').html('<img src="../../image/home/plant.png" alt="">')
					$('#analysis').html('<img src="../../image/home/people.png" alt="">')
					$('#openCall').html('<img src="../../image/home/ask.png" alt="">')
					$('#openMarketInfo').html('<img src="../../image/home/mark.png" alt="">')
		    }else{
		        //  alert( JSON.stringify( err ) );
		    }
		});


			//判断终端传设备码
			var code = ''
			var systemType = api.systemType;
			// alert(systemType)
			if(systemType == 'ios'){
				code = 'e9b66e519c6944e595f47af8a7e45497'
			}else {
				code = 'fca9b5db26b24e32b2743950578661c1'
			}
			//轮播图****************************
			homeBannerGet(code);
			// 轮播（图片点击跳转页面）
			JumpPage()
			// 获取首页列表数据渲染HTML
			getHomeList(code)
			// 点击更多跳转列表
			$('#gotolist').on('click',function(){
				goToList(code)
			})

			//实时定位获取位置，并获取天气信息****
			var map = api.require('bMap');
			getLocation(map);
			//$api.clearStorage();
			getNoticeContent(code);
	}
//**************DW****************************************************************************//
	// 轮播 （请求后台数据）
	function homeBannerGet(code){

		pds.ajaxSubmit({
			url:"app/sys/get_adv",
			data:{"code":code,"place":'home'},
			success:function(e){
					// alert('hhhhhhh'+JSON.stringify(e))
				// console.log('hhhhhhhhhhhhhhhhhhhhhhh'+JSON.stringify(e.data.data))
				if(e.data !== null && e.data !== ''){
					var data = e.data.data || '';
					if(data.length > 0){
						var img = ''
						for(var i = 0; i < data.length; i++){
							img += '<div class="swiper-slide" data-id="'+data[i].title+'"><img data-id="'+data[i].url+'" src="'+data[i].pictureUrl+'"></div>'
						}
						$('#banner').html(img)
					}else{
							$('#banner').html('<div class="swiper-slide" ><img src="../../image/home/home-banner.png"></div>')
					}
					if(data.length >1){
						// img渲染成功后调用轮播功能
						var mySwiper = new Swiper ('#bannerContainer', {
							 direction: 'horizontal',
							 autoplay: 3000,
							 speed:300,
							 loop: true,
							//  observer:true,
							// 	preloadImages:true,
							// 	updateOnImagesReady : true,
							// 	speed:1000,
							// 	autoplayDisableOnInteraction : false,
							// 	effect : 'coverflow',
							// 	slidesPerView: 1.25,
							// 	centeredSlides: true,
							// 	spaceBetween : 0,
							// 	coverflow: {
							// 					rotate: 0,
							// 					stretch: -48,
							// 					depth: 200,
							// 					modifier: 1,
							// 					slideShadows : false
							// 	},
							 pagination : '.swiper-pagination',
							 paginationClickable: true,
							 autoplayDisableOnInteraction : false
						})
					}else{
						// var mySwiper = new Swiper ('#bannerContainer', {
						// 	 direction: 'horizontal',
						// 	 observer:true,
						// 	 preloadImages:true
						// })
					}
				}
			},
			error:function(e){
				api.alert({msg:"服务器错误，请联系管理员!"});
			}
		});
	}

	// 轮播（图片点击跳转页面）
	function JumpPage() {

		 $('#banner').on('click','.swiper-slide',function() {
			if($(this).find('img').attr('data-id')){
				// alert($(this).attr('data-id'))
				api.openWin({
					name:'advertisement_win',
					url:'../advertisement_win.html',
					pageParam:{
						url:$(this).find('img').attr('data-id'),
						title:$(this).attr('data-id')
					}
				})
			}else {
				// alert('meiyou ')
			}

		})
	}

	// 获取首页列表数据渲染HTML
	function getHomeList(code) {
		pds.ajaxSubmit({
			url:"app/sys/get_adv",
			data:{"code":code,"place":'list'},
			success:function(e){
						// alert(JSON.stringify(e))
				if(e.data !== null && e.data !== ''){

					var data = e.data.data || '';
					// alert(JSON.stringify(data))
					if(data.length > 0){
						var techDataStr = ''
						for(var i = 0; i <= 1; i++){
							if(data[i].contentTypeName == ''){
								data[i].contentTypeName = '广告'
							}
							techDataStr += '<div class="list-item" type="'+ data[i].type +'" id="'+data[i].contentId+'" onclick="goToDetail(this)">'+
												   			'<div class="left">'+
														 			'<div class="data-content" style="display:none;">'+ data[i].content +'</div>'+
																	'<div class="data-url" style="display:none;">'+ data[i].url +'</div>'+
																	'<div class="data-author" style="display:none;">'+ data[i].author +'</div>'+
																	'<div class="title data-title">'+ data[i].title +'</div>'+
																	'<span class="type contentTypeName">'+ data[i].contentTypeName +'</span>'+
																	'<span class="date data-date">'+ (data[i].publishDate).split(" ")[0] +'</span>'+
																'</div>'+
																'<div class="right">'+
																  '<img src="'+ data[i].pictureUrl +'" alt="">'+
																'</div>'+
														'</div>'
						}
						$(".list-content").html(techDataStr)
					}else {
						$('#gotolist').hide()
					}
				}
			},
			error:function(e){
				api.alert({msg:"服务器错误，请联系管理员!"});
			}
		});

	}

	// 首页列表点击跳转
	function goToDetail(node) {
		// alert($(node).attr('type'))
		var type = $(node).attr('type')
		if(type == 'news_adv'){
		// 跳转内容
			var obj ={
				content:$(node).find('.data-content').html(),
				title:$(node).find('.data-title').html(),
				author:$(node).find('.data-author').html(),
				time:$(node).find('.data-date').html(),
				id:$(node).attr('id'),
				type:$(node).find('.contentTypeName').html()
			}
			api.openWin({
				name:'content-detail_win',
				url:'./content-detail_win.html',
				pageParam:obj,
				slidBackEnabled : false,
				animation : {
					type : "movein", //动画类型（详见动画类型常量）
					subType : "from_right", //动画子类型（详见动画子类型常量）
					duration : 300 //动画过渡时间，默认300毫秒
				}
			})
		}else {
		// 跳转url
			var obj ={
				url:$(node).find('.data-url').html(),
				title:$(node).find('.data-title').html()
			}
			api.openWin({
				name:'advertisement_win',
				url:'../advertisement_win.html',
				pageParam:obj,
				slidBackEnabled : false,
				animation : {
					type : "movein", //动画类型（详见动画类型常量）
					subType : "from_right", //动画子类型（详见动画子类型常量）
					duration : 300 //动画过渡时间，默认300毫秒
				}
			})
		}

	}

	// 点击更多跳转列表
	function goToList(code){

		api.openWin({
			name:'a-list_win',
			url:'./a-list_win.html',
			pageParam:{
				code:code
			},
			slidBackEnabled : false,
			animation : {
				type : "movein", //动画类型（详见动画类型常量）
				subType : "from_right", //动画子类型（详见动画子类型常量）
				duration : 300 //动画过渡时间，默认300毫秒
			}
		})

	}


	//公告内容获取
	function getNoticeContent(code){
		pds.ajaxSubmit({
			url:"app/sys/get_adv",
			data:{"code":code,"place":'notice'},
			success:function(e){
				//console.log('eeeeee'+JSON.stringify(e))
			if(e.data !== null && e.data !== ''){
				var data=e.data.data||[];
				if(data.length>0){
				  var str='';
				  for (var i = 0,len= data.length; i < len; i++) {
					  str+='<div class="swiper-slide" onclick="noticeDetail(this)" data-id="'+data[i].id+'" data-time="'+data[i].pubdate.split(' ')[0]+'" data-author="'+data[i].author+'"><div class="noticeTitle">'+data[i].title+'</div><div class="noticeContent">'+data[i].content+'</div></div>'
				  }

				 $('#noticeTitle .swiper-wrapper').html(str);
	         if(data.length>1){
						 var mySwiper = new Swiper ('#noticeTitle', {
							    direction: 'vertical',
					      	loop:true,
								  speed:1000,
								  autoplay:5000
							})
					 }
					 var dataList=data
					 $('#noticeListMore').on('click',function(){
						 noticeListMore(dataList)
					 })
				}
			}
			},
			error:function(e){
				api.alert({msg:"服务器错误，请联系管理员!"});
			}
		});
	}

	function noticeDetail(node){
	 			 var obj={
	 				 content:$(node).find('.noticeContent').html(),
	 				 title:$(node).find('.noticeTitle').text(),
	 				 author:$(node).attr('data-author'),
	 				 time:$(node).attr('data-time'),
	 				 id:$(node).attr('data-id')
	 			 }
	 			 api.openWin({
	 				 name:'content-detail_win',
	 				 url:'./content-detail_win.html',
	 				 slidBackEnabled : false,
	 				 pageParam:obj,
	 				 animation : {
	 					 type : "movein", //动画类型（详见动画类型常量）
	 					 subType : "from_right", //动画子类型（详见动画子类型常量）
	 					 duration : 300 //动画过渡时间，默认300毫秒
	 				 }
	 			 })
 	}

	function noticeListMore(list){
		api.openWin({
			name:'noticeList_win',
			url:'./noticeList_win.html',
			slidBackEnabled : false,
			pageParam:list,
			animation : {
				type : "movein", //动画类型（详见动画类型常量）
				subType : "from_right", //动画子类型（详见动画子类型常量）
				duration : 300 //动画过渡时间，默认300毫秒
			}
		})
	}

	//点击“种植计算器”入口
	function openPlant(){
		$('#openPlant').html('<img src="../../image/home/plant-a.png" alt="">')
		api.openWin({
			name: 'index_win',
			url: '../calculator/index_win.html',
			slidBackEnabled: false,
			animation: {
				type: "movein", //动画类型（详见动画类型常量）
				subType: "from_right", //动画子类型（详见动画子类型常量）
				duration: 300 //动画过渡时间，默认300毫秒
			}
		})
	}
	//**************DW****************************************************************************//

	//	点击“我的记工”页面跳转
	function analysis() {
		$('#analysis').html('<img src="../../image/home/people-a.png" alt="">')
		api.openWin({
			name : "list_win",
			url : "widget://html/home/efficiency/efficiency_win.html",
			reload : true,
			selecteIndex : '3',
			slidBackEnabled : false,
			animation : {
				type : "movein", //动画类型（详见动画类型常量）
				subType : "from_right", //动画子类型（详见动画子类型常量）
				duration : 300 //动画过渡时间，默认300毫秒
			}
		});
	}
	//点击“问问专家”入口
	function openCall(){
		$('#openCall').html('<img src="../../image/home/ask-a.png" alt="">')
		api.openWin({
			name : "questionlist_win",
			url:"widget://html/che/expert/questionlist_win.html",
			reload : true,
			selecteIndex : '3',
			slidBackEnabled : false,
			animation : {
				type : "movein", //动画类型（详见动画类型常量）
				subType : "from_right", //动画子类型（详见动画子类型常量）
				duration : 300 //动画过渡时间，默认300毫秒
			}
		})
	}
	//点击跳转市场分析
	function openMarketInfo(){
			$('#openMarketInfo').html('<img src="../../image/home/mark-a.png" alt="">')
			api.openWin({
				name:'market-index-win',
				url:'./marketInfo/market-index-win.html',
				slidBackEnabled : false,
				animation : {
					type : "movein", //动画类型（详见动画类型常量）
					subType : "from_right", //动画子类型（详见动画子类型常量）
					duration : 300 //动画过渡时间，默认300毫秒
				}
			})
	}

	//获取位置信息******************************
	function getLocation(map){
		map.getLocation({
			accuracy : '10m',
			autoStop : true,
			filter : 1
		}, function(ret, err) {//localStorage.clear();
			if (ret.status) {
				var lon = ret.lon;
				var lat = ret.lat;
				// alert(lon+'------'+lat)
				getWeatherMsg(lon, lat);
			} else {
				api.alert({msg: "获取定位信息失败"});
			}
		});

	}

	// 根据经纬度从阿里获取天气数据*************************************************************
	var storageKey = "weather";
	var oldWeatherTimeKey = "oldTime";
	var addressKey = "address";
	function getWeatherMsg(lon, lat) {
		var url = "https://ali-weather.showapi.com/gps-to-weather?from=5&lat=" + lat + "&lng=" + lon + "&need3HourForcast=0&needAlarm=0&needHourData=0&needIndex=0&needMoreDay=1";
		$.ajax({
			url : url,
			type : "get",
			beforeSend : function(req) {
				req.setRequestHeader("Authorization", "APPCODE acacbfc4fac2472996b28490cd77c8be");
			},
			dataType : "json",
			success : function(data) {
					// alert(JSON.stringify(data))
				showWeatherMsg(data);
			},
			error : function(e) {
				api.alert({msg:"网络异常，请重试!"});
			}
		});
	}

	//展示天气数据*********************************************************************
	function showWeatherMsg(data) {
		var weather = data.showapi_res_body;
		var now = weather.now;
		var cityInfo = weather.cityInfo;
		// alert(JSON.stringify(data))
		// 得到区市名
		$("#weather_city").text(cityInfo.c7);
		//得到市区名
		$("#weather_area").text(cityInfo.c3);
		// 天气
		$("#weather_text").text(now.weather);
		// 天气小图标
		$(".weather-img").html("<img src='" + now.weather_pic + "'/>");
		// 实时温度
		$("#now_temp").text(now.temperature+"℃");
		// 展示一周的数据
		var dateArray = ["f1", "f2", "f3", "f4", "f5", "f6", "f7"];
		var html;
		var w = weather.f1;
		// 当天的最高和最低气温
		$("#all_temp").html("<span>" + w.day_air_temperature + "°/" + w.night_air_temperature + "°</span>");
	};


</script>
</html>
