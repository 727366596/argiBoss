<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>技术推广</title>
    <link rel="stylesheet" type="text/css" href="../../../css/common/api.css"/>
    <link rel="stylesheet" type="text/css" href="../../../css/common/reset.css"/>
    <link rel="stylesheet" type="text/css" href="../../../css/common/iscroll-style.css"/>
    <script type="text/javascript" src="../../../script/common/rem.js"></script>
    <style>
    		*{
            box-sizing: border-box;
        }
        html,body{
            width:100%;
						/*position: relative;
						height: 100%;*/
            /*height:100%;*/
        }
        header{
            /*position: fixed;
            left: 0;
            top:0;*/
            /*top: 0.44rem;*/
            height:1.35rem;
            width: 100%;
            background: #00c558;
            z-index: 99;
        }
        header #title{
            position: relative;
            width:100%;
            height: 0.88rem;
            line-height: 0.88rem;
            text-align: center;
            font-size: 0.36rem;font-family: PingFangSC-Regular, sans-serif;color: #fff;
        }
        header #title span.left{
           	display: inline-block;
						position: absolute;
						left: 13px;
						bottom: 14px;
						width: 10px;
						height: 18px;
						background-image: url(../../../image/harvest_back.png);
						background-position: center;
						background-size: 100% 100%;
						background-repeat: no-repeat;
        }
				#searchBtn{
						position:absolute;
						right: 13px;
						bottom: 0px;
						font-size: 0.32rem;font-family: PingFangSC-Regular, sans-serif;color: #fff;
				}
        #wrapper{
            width:100%;
						position: absolute;
						left: 0;
						right: 0;
						top: 2.15rem;
						bottom: 0;
						overflow-y: auto;
						z-index: 1;
						/*padding-bottom:1.0rem;*/
						background-color: #f2f2f2;
        }
        #wrapper .scroller,#wrapper .scroller>ul,#wrapper .scroller>ul>li{
            width:100%;
        }
				#wrapper .scroller>ul>li{
					position: relative;
					width:100%;
					/*height:1.46rem;*/
					padding: 0.15rem 0.2rem;
					border-bottom: solid 1px #f3f3f4;
					display: -webkit-box;
					display: -webkit-flex;
					display:flex;

					-webkit-box-orient: horizontal;
					-webkit-flex-flow: row;
					flex-flow: row;

					-webkit-box-pack: justify;
					-webkit-justify-content: space-between;
					justify-content: space-between;

					-webkit-box-align: center;
					-webkit-align-items: center;
					align-items: center;
				}
				#wrapper .scroller>ul>li .transfer_content_left{
					position: relative;
					/*width: 4.27rem;*/
					/*width: 100%;*/
					height: 100%;
					padding: 0.2rem;
				}
				#wrapper .scroller>ul>li .transfer_content_left .transfer_content_info{
					/*width: 100%;*/
					word-break:break-all; word-wrap:break-word ;
				}
				#wrapper .scroller>ul>li .transfer_content_left .transfer_content_info>p{
					position: relative;
					/*width: 100%;*/
					/*height: 0.36rem;*/
					line-height: 0.36rem;
					text-align:left;font-size: 0.26rem;font-family: PingFangSC-Regular, sans-serif;color: #747474;
				}
				#wrapper .scroller>ul>li .transfer_content_left .transfer_content_info>p span{
					display: inline-block;
					height: 0.27rem;
					line-height: 0.3rem;
					margin-left: 0.1rem;
					padding-right: 0.1rem;
					text-indent: 0.3rem;font-size: 0.18rem;font-family: PingFangSC-Regular, sans-serif;color:#006ACD;
					border-radius: 0.03rem;
					background: url(../../image/home_transfer_content_tuijian.png) no-repeat 0.1rem center;
					background-size: 20% 60%;
					background-color: #f6f7fc;
				}
				#wrapper .scroller>ul>li .transfer_content_left .transfer_content_time>p{
					height: 0.2rem;
					line-height: 0.2rem;
					margin-top: 0.3rem;
					text-align:left;font-size: 0.2rem;font-family: PingFangSC-Regular, sans-serif;color: #AEADAD;
				}
				#wrapper .scroller>ul>li .transfer_content_right{
					/*width: 1.7rem;*/
					height: 1.12rem;
					position:relative;
					top:-0.07rem;
					left:-0.1rem;
				}
				#wrapper .scroller>ul>li .transfer_content_right>img{

					height: 100%;
					margin-top: 0.1rem;
				}
				.nav{
						/*position: fixed;
						top:1.35rem;
						left:0;
						z-index: 99;*/
						width: 100%;
						height:0.8rem;
						background: #f2f2f2;
						display: -webkit-box;
            display: -webkit-flex;
            display:flex;

            -webkit-box-orient: horizontal;
            -webkit-flex-flow: row;
            flex-flow: row;

            -webkit-box-pack: justify;
            -webkit-justify-content: space-around;
            justify-content: space-around;

            -webkit-box-align: center;
            -webkit-align-items: center;
            align-items: center;
				}
				.nav span{
					height: 100%;
					width: 24%;
					line-height: 0.8rem;
					text-align: center;
					font-size: 0.28rem;font-family: PingFangSC-Regular, sans-serif;color: #717475;
				}
				#emptyPage{
      			position: absolute;
      			/*left:50%;
      			top:50%;
      			width:210px;
      			height:220px;
      			margin-left:-105px;
      			margin-top:-110px;*/
						left:0;
						right: 0;
						bottom: 0;
						top:2.15rem;
      			display:none;
						z-index: 999;
						background-color: #fff;
      		}
      		#emptyPage .emptyBcImg{
      			width:210px;
      			height:145px;
      			margin:0 auto;
						margin-top: 2.6rem;
      			background-image: url(../../../image/emptyPageIcon.png);
      			background-position: center;
      			background-size: 100% 100%;
      			background-repeat: no-repeat;
      		}
      		#emptyPage p{
      			width:100%;
      			height:20px;
      			line-height:20px;
      			text-align: center;margin-top: 0.2rem;
      			font-size: 16px;font-family: PingFangSC-Regular, sans-serif;color: #999999;
      		}
					.infoListWidth{
							width:75%;
					}

					#body_totop_btn{
	            position: fixed;
	            bottom:0.5rem;
	            right:0.2rem;
	            width:1.2rem;
	            height:1.2rem;
	            z-index: 999;
	            line-height: 2.25rem;
	            font-size: 0.2rem;font-family: PingFangSC-Regular, sans-serif;color: #AEADAD;
	            text-align: center;
	            background: url("../../../image/rocket_up.png") no-repeat center 3px;
	            background-size: 70% 70%;
	            background-color: rgba(0,0,0,0);
	            border-radius: 6px;
	            font-size: 0.20rem;
	            color: #20c714;
	            display: none;
	        }
    </style>
</head>
<body>

    <header id="header">
        <div id="title">
            <span class="left" onclick="back()"></span>技术推广<span id='searchBtn' onclick="openSearch();">搜索</span>
        </div>
    </header>
		<div class="nav">
				<span id="allTec">全部</span>
				<span id="11">农业技术</span>
				<span id="12">行业政策</span>
				<span id="13">农村生活</span>
		</div>
    <div id="wrapper" style="">
        <div class="scroller" style="">
            <ul style="">
            </ul>
						<div class="more" style="height:1.0rem;">
	             	<i class="pull_icon"></i>
	             	<span style="font-size: 0.28rem;font-family: PingFangSC-Regular, sans-serif;color: #747474;">上拉加载更多...</span>
            </div>
        </div>
    </div>

		<div id="body_totop_btn">
        返回顶部
    </div>
		<div id="emptyPage">
			<div class="emptyBcImg"></div>
			<p>亲，还没有新的内容哦~</p>
		</div>
</body>
<script type="text/javascript" src="../../../script/common/api.js"></script>
<script type="text/javascript" src="../../../script/common/jquery.min.js"></script>
<!-- <script type="text/javascript" src="../../../script/common/zepto-1.2.0.min.js"></script> -->
<script type="text/javascript" src="../../../script/common/pds.ajax.js"></script>
<script type="text/javascript" src="../../../script/common/iscroll.js"></script>
<script type="text/javascript">
	apiready = function(){
		//		沉浸式状态栏
		var header=$api.byId("header");
    $api.fixStatusBar(header);
		tabCheck();
		//默认触发全部
		$("#allTec").triggerHandler('click');

		//scrollToTop();
	};

	//页面回到顶部
	function scrollToTop(){
			$("#wrapper").on("scroll",function(){
					var scrollTop = $("#wrapper").scrollTop();
					if(scrollTop >= 300){
							$("#body_totop_btn").show().off("click").on("click",function(){
									$("#wrapper").animate({'scrollTop': '0px'}, 200);
									//myScroll.scrollTo(0, 0, 300)
							})
					}else{
							$("#body_totop_btn").hide();
					}
			})
	};

	//上滑刷新
	var myscroll;

	function pageScroll(type, bulidFlag){
		//var fingerMoveFlag = false;
		myscroll = new iScroll("wrapper",{
				onScrollMove:function(){
					if (this.y<(this.maxScrollY)) {
						$('.pull_icon').addClass('flip');
						$('.pull_icon').removeClass('loading');
						$('.more span').text('释放加载...');
					}else{
						$('.pull_icon').removeClass('flip loading');
						$('.more span').text('上拉加载更多...')
					}
				},
				onScrollEnd:function(){
					if ($('.pull_icon').hasClass('flip')) {
						$('.pull_icon').addClass('loading');
						$('.more span').text('加载中...');
						//fingerMoveFlag = !fingerMoveFlag;
						//if(fingerMoveFlag){
								setTimeout(function(){
									page++;
									pullUpAction(page, type, pageSize);
								},300)
						//}
					}

				},
				onRefresh:function(){
					$('.more').removeClass('flip');
					$('.more span').text('上拉加载更多...');
				}
		});
		//		判断临界情况***************************************
		if ($('.scroller').height()<$('#wrapper').height()) {
				//$('.more').hide();
				myscroll.destroy();
		};

	}

	//导航tab切换
	var page = 1, pageSize = 7;
	function tabCheck(){
		$(".nav span").off("click").on("click",function(){
				$(".nav span").css({
						"color":"#717475",
						"border":"none",
						"fontWeight":"400",
						"backgroundColor":"#f2f2f2"
				});
				$(this).css({
						"color":"#82e668",
						"border-bottom":"solid 2px #82e268",
						"fontWeight":"500",
						"backgroundColor":"#dedede"
				});
				$("#wrapper .scroller ul").html("");
				$('.more').removeClass('flip');
				$('.more span').text('上拉加载更多...');

				var type = $(this).attr("id");
				page = 1;
				if(type != "allTec" && type != null){
					//alert(page);
						pullUpAction(page, type, pageSize);
				}else{
					//alert(page);
						type = "";
						pullUpAction(page, type, pageSize);
				};
		})
};

//请求数据***************************************
function pullUpAction(page, type, pageSize){
			//page++;
			pds.ajaxSubmit({
				 url:"/app/content/techContentList",
				 //type : "GET",
				 //  dataType:"json",
				 //contentType:"application/json",
				 data:{"data":JSON.stringify({
							 		page : page,
									pageSize : pageSize,
									data : {
											articleType:type
									}
						 	})
				 },
				 success:function(e){
					 	//alert(page)
						//alert(JSON.stringify(e))
						if(e.total >= 0){
								var techListArr = e.data;
								var techListStr = "";
								var articleTypeName = null;
								//console.log("*******************"+techListArr.length+"**********************")
								if(techListArr != "" && techListArr != null && techListArr != []){
										$("#emptyPage").hide();
										$('.more').show();
										for (var i = 0; i < techListArr.length; i++) {

											switch (techListArr[i].articleType) {
												case 11:
													articleTypeName = "农业技术"
													break;
												case 12:
													articleTypeName = "行业政策"
													break;
												case 13:
													articleTypeName = "农村生活"
													break;
											};
											var techDataImg = "", infoListWidth = "";
											if(techListArr[i].pictureUrl != "" && techListArr[i].pictureUrl != null){
													techDataImg = '<img style="width: 1.7rem;" src="'+ techListArr[i].pictureUrl +'">'
													infoListWidth = "infoListWidth";
											};
											techListStr += '<li class="" onclick="openTechTransferInfo('+ techListArr[i].contentId +')">'+
																				'<div class="transfer_content_left'+ " " + infoListWidth +'">'+
																						'<div class="transfer_content_info">'+
																								'<p>'+ techListArr[i].title +'</p>'+
																						'</div>'+
																						'<div class="transfer_content_time"><p><span>'+ articleTypeName +'</span><span style="margin-left:10px;">'+ (techListArr[i].createTime).split(" ")[0] +'</span><span style="margin-left:20px;">作者：'+ techListArr[i].author +'</span></p></div>'+
																				'</div>'+
																				'<div class="transfer_content_right">'+ techDataImg +'</div>'+
																		'</li>';
										};

										$("#wrapper .scroller ul").append(techListStr);
										scrollToTop();
										if(pageSize*page<e.total){
												$("#wrapper").css({"overflow":"hidden"});
												pageScroll(type);//开启上滑加载
										}else{
												//alert("哈哈哈")
												// myscroll.refresh();
												//pageScroll(type);//开启上滑加载
												myscroll.destroy();
												setTimeout(function(){
														$("#wrapper").css({"overflow":"auto"});
														$('.pull_icon').removeClass('flip loading');
														$('.more span').text('已经加载至最后...')
												},100)

										}

								}else{
										//$('.more span').text('暂无数据...')
										$("#emptyPage").show();
										$('.more').hide();
								}

						};

				 },
				 error:function(e){
						api.alert({msg:"服务器异常，请联系管理员!"});
				 }
			});
};

//打开技术详情页面***************************************************
function openTechTransferInfo(id){
	api.openWin({
		name : "frm_home_tech_transfer_info",
		url : "widget://html/home/techTransfer/win_home_tech_transfer_info.html",
		reload : true,
		selecteIndex : '3',
		slidBackEnabled : false,
		pageParam : {
				contentId : id
		},
		animation : {
			type : "movein", //动画类型（详见动画类型常量）
			subType : "from_right", //动画子类型（详见动画子类型常量）
			duration : 300 //动画过渡时间，默认300毫秒
		}
	});
};

//打开技术搜索页面***************************************************
function openSearch(){
	api.openWin({
		name : "win_home_tech_transfer_search_win2",
		url : "widget://html/home/techTransfer/win_home_tech_transfer_search_win2.html",
		reload : true,
		slidBackEnabled : false,
		animation : {
			type : "movein", //动画类型（详见动画类型常量）
			subType : "from_right", //动画子类型（详见动画子类型常量）
			duration : 300 //动画过渡时间，默认300毫秒
		}
	});
};

//返回上一级********************************************************************
	function back() {
		api.closeWin();
	}
</script>
</html>
