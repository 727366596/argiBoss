<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
	<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
	<title>启动页</title>
	<style media="screen">
		html,
		body {
			width: 100%;
			height: 100%;
			background: #fdfdfd;
			overflow: hidden;
			margin: 0;
			padding: 0;
		}

		.jump {
			position: absolute;
			top: 30px;
			right: 10px;
			background: #cdcdcd;
			width: 40px;
			height: 40px;
			line-height: 40px;
			font-size: 24px;
			text-align: center;
			border-radius: 50%;
		}

		span {
			display: inline-block;
		}

		img {
			width: 100%;
			height: 100%;
		}
	</style>
	<script type="text/javascript" src="../../script/common/rem.js"></script>
	<script type="text/javascript" src="../../script/common/api.js"></script>
	<script type="text/javascript" src="../../script/common/jquery.min.js"></script>
	<script type="text/javascript" src="../../script/common/pds.ajax.js"></script>
</head>

<body>
	<img src="../../image/start.jpg" alt="">
	<div class="jump">3</div>
</body>

<script type="text/javascript">
	apiready = function() {
		api.parseTapmode();
		api.setFullScreen({
			fullScreen: true
		});
		jumpLogin();
		advImg();
		api.addEventListener({
			name: 'openLogin'
		}, function(ret, err) {
			if (ret) {
				jumpSlogin()
			}
		});
		api.addEventListener({
			name: 'keyback'
		}, function(ret, err) {
			if (ret) {
				api.closeWidget({});
			}
		});

	};

	function advImg() {
		var systemType = api.systemType;
		var code = ''
		if (systemType === 'ios') {
			code = "e9e312fce8a741958c817ba5bdbe6b17"
		} else if (systemType === 'android') {
			code = "5fb756a9831c439d87fc338b4050a990"
		}
		pds.ajaxSubmit({
			url: "app/sys/get_adv",
			data: {
				"code": code,
				"place": 'start'
			},
			success: function(e) {
				console.log('++++++++' + JSON.stringify(e))
				setTimeout(function() {
					var number = 3;
					var time = setInterval(function() {
						number--;
						if (number > 0) {
							$('.jump').text(number)
						} else {
							clearInterval(time)
						}
					}, 1000)
				}, 1500);
				if (e.data !== null && e.data !== '') {
					var data = e.data.data || []
					if (data.length > 0) {
						var pictureUrl = data[0].pictureUrl
							// var url= data[0].url
						$('img').attr('src', pictureUrl)
						$('img').on('click', function() {
							jumpPage(data[0].title, data[0].url)
						})
					}
				}
			},
			error: function(e) {
				api.alert({
					msg: "服务器错误，请联系管理员!"
				});
			}
		});
	}
	var settime;

	function jumpLogin() {
		settime = setTimeout(function() {
			api.openWin({
				name: "login_new",
				url: "widget://html/login/login_new.html",
				reload: true,
				slidBackEnabled: false,
				animation: {
					type: "movein", //动画类型（详见动画类型常量）
					subType: "from_right", //动画子类型（详见动画子类型常量）
					duration: 400 //动画过渡时间，默认300毫秒
				}
			});
		}, 3000)
	}

	function jumpSlogin() {
		clearTimeout(settime)
		api.openWin({
			name: "login_new",
			url: "widget://html/login/login_new.html",
			reload: true,
			slidBackEnabled: false,
			animation: {
				type: "movein", //动画类型（详见动画类型常量）
				subType: "from_right", //动画子类型（详见动画子类型常量）
				duration: 400 //动画过渡时间，默认300毫秒
			}
		});
	}
	$('.jump').on('click', jumpSlogin)

	function jumpPage(title, url) {
		api.openWin({
			name: 'startPage_win',
			url: './startPage.html',
			pageParam: {
				title: title,
				url: url
			},
			animation: {
				type: "movein", //动画类型（详见动画类型常量）
				subType: "from_right", //动画子类型（详见动画子类型常量）
				duration: 400 //动画过渡时间，默认300毫秒
			}
		});
		clearTimeout(settime)
	}
</script>

</html>
